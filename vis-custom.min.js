(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.vis=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){exports.DataSet=require("./lib/DataSet.js");exports.Timeline=require("./lib/timeline/Timeline")},{"./lib/DataSet.js":2,"./lib/timeline/Timeline":14}],2:[function(require,module,exports){var util=require("./util");var Queue=require("./Queue");function DataSet(data,options){if(data&&!Array.isArray(data)&&!util.isDataTable(data)){options=data;data=null}this._options=options||{};this._data={};this.length=0;this._fieldId=this._options.fieldId||"id";this._type={};if(this._options.type){for(var field in this._options.type){if(this._options.type.hasOwnProperty(field)){var value=this._options.type[field];if(value=="Date"||value=="ISODate"||value=="ASPDate"){this._type[field]="Date"}else{this._type[field]=value}}}}if(this._options.convert){throw new Error('Option "convert" is deprecated. Use "type" instead.')}this._subscribers={};if(data){this.add(data)}this.setOptions(options)}DataSet.prototype.setOptions=function(options){if(options&&options.queue!==undefined){if(options.queue===false){if(this._queue){this._queue.destroy();delete this._queue}}else{if(!this._queue){this._queue=Queue.extend(this,{replace:["add","update","remove"]})}if(typeof options.queue==="object"){this._queue.setOptions(options.queue)}}}};DataSet.prototype.on=function(event,callback){var subscribers=this._subscribers[event];if(!subscribers){subscribers=[];this._subscribers[event]=subscribers}subscribers.push({callback:callback})};DataSet.prototype.subscribe=DataSet.prototype.on;DataSet.prototype.off=function(event,callback){var subscribers=this._subscribers[event];if(subscribers){this._subscribers[event]=subscribers.filter(function(listener){return listener.callback!=callback})}};DataSet.prototype.unsubscribe=DataSet.prototype.off;DataSet.prototype._trigger=function(event,params,senderId){if(event=="*"){throw new Error("Cannot trigger event *")}var subscribers=[];if(event in this._subscribers){subscribers=subscribers.concat(this._subscribers[event])}if("*"in this._subscribers){subscribers=subscribers.concat(this._subscribers["*"])}for(var i=0;i<subscribers.length;i++){var subscriber=subscribers[i];if(subscriber.callback){subscriber.callback(event,params,senderId||null)}}};DataSet.prototype.add=function(data,senderId){var addedIds=[],id,me=this;if(Array.isArray(data)){for(var i=0,len=data.length;i<len;i++){id=me._addItem(data[i]);addedIds.push(id)}}else if(util.isDataTable(data)){var columns=this._getColumnNames(data);for(var row=0,rows=data.getNumberOfRows();row<rows;row++){var item={};for(var col=0,cols=columns.length;col<cols;col++){var field=columns[col];item[field]=data.getValue(row,col)}id=me._addItem(item);addedIds.push(id)}}else if(data instanceof Object){id=me._addItem(data);addedIds.push(id)}else{throw new Error("Unknown dataType")}if(addedIds.length){this._trigger("add",{items:addedIds},senderId)}return addedIds};DataSet.prototype.update=function(data,senderId){var addedIds=[];var updatedIds=[];var updatedData=[];var me=this;var fieldId=me._fieldId;var addOrUpdate=function(item){var id=item[fieldId];if(me._data[id]){id=me._updateItem(item);updatedIds.push(id);updatedData.push(item)}else{id=me._addItem(item);addedIds.push(id)}};if(Array.isArray(data)){for(var i=0,len=data.length;i<len;i++){addOrUpdate(data[i])}}else if(util.isDataTable(data)){var columns=this._getColumnNames(data);for(var row=0,rows=data.getNumberOfRows();row<rows;row++){var item={};for(var col=0,cols=columns.length;col<cols;col++){var field=columns[col];item[field]=data.getValue(row,col)}addOrUpdate(item)}}else if(data instanceof Object){addOrUpdate(data)}else{throw new Error("Unknown dataType")}if(addedIds.length){this._trigger("add",{items:addedIds},senderId)}if(updatedIds.length){this._trigger("update",{items:updatedIds,data:updatedData},senderId)}return addedIds.concat(updatedIds)};DataSet.prototype.get=function(args){var me=this;var id,ids,options,data;var firstType=util.getType(arguments[0]);if(firstType=="String"||firstType=="Number"){id=arguments[0];options=arguments[1];data=arguments[2]}else if(firstType=="Array"){ids=arguments[0];options=arguments[1];data=arguments[2]}else{options=arguments[0];data=arguments[1]}var returnType;if(options&&options.returnType){var allowedValues=["DataTable","Array","Object"];returnType=allowedValues.indexOf(options.returnType)==-1?"Array":options.returnType;if(data&&returnType!=util.getType(data)){throw new Error('Type of parameter "data" ('+util.getType(data)+") "+"does not correspond with specified options.type ("+options.type+")")}if(returnType=="DataTable"&&!util.isDataTable(data)){throw new Error('Parameter "data" must be a DataTable '+'when options.type is "DataTable"')}}else if(data){returnType=util.getType(data)=="DataTable"?"DataTable":"Array"}else{returnType="Array"}var type=options&&options.type||this._options.type;var filter=options&&options.filter;var items=[],item,itemId,i,len;if(id!=undefined){item=me._getItem(id,type);if(filter&&!filter(item)){item=null}}else if(ids!=undefined){for(i=0,len=ids.length;i<len;i++){item=me._getItem(ids[i],type);if(!filter||filter(item)){items.push(item)}}}else{for(itemId in this._data){if(this._data.hasOwnProperty(itemId)){item=me._getItem(itemId,type);if(!filter||filter(item)){items.push(item)}}}}if(options&&options.order&&id==undefined){this._sort(items,options.order)}if(options&&options.fields){var fields=options.fields;if(id!=undefined){item=this._filterFields(item,fields)}else{for(i=0,len=items.length;i<len;i++){items[i]=this._filterFields(items[i],fields)}}}if(returnType=="DataTable"){var columns=this._getColumnNames(data);if(id!=undefined){me._appendRow(data,columns,item)}else{for(i=0;i<items.length;i++){me._appendRow(data,columns,items[i])}}return data}else if(returnType=="Object"){var result={};for(i=0;i<items.length;i++){result[items[i].id]=items[i]}return result}else{if(id!=undefined){return item}else{if(data){for(i=0,len=items.length;i<len;i++){data.push(items[i])}return data}else{return items}}}};DataSet.prototype.getIds=function(options){var data=this._data,filter=options&&options.filter,order=options&&options.order,type=options&&options.type||this._options.type,i,len,id,item,items,ids=[];if(filter){if(order){items=[];for(id in data){if(data.hasOwnProperty(id)){item=this._getItem(id,type);if(filter(item)){items.push(item)}}}this._sort(items,order);for(i=0,len=items.length;i<len;i++){ids[i]=items[i][this._fieldId]}}else{for(id in data){if(data.hasOwnProperty(id)){item=this._getItem(id,type);if(filter(item)){ids.push(item[this._fieldId])}}}}}else{if(order){items=[];for(id in data){if(data.hasOwnProperty(id)){items.push(data[id])}}this._sort(items,order);for(i=0,len=items.length;i<len;i++){ids[i]=items[i][this._fieldId]}}else{for(id in data){if(data.hasOwnProperty(id)){item=data[id];ids.push(item[this._fieldId])}}}}return ids};DataSet.prototype.getDataSet=function(){return this};DataSet.prototype.forEach=function(callback,options){var filter=options&&options.filter,type=options&&options.type||this._options.type,data=this._data,item,id;if(options&&options.order){var items=this.get(options);for(var i=0,len=items.length;i<len;i++){item=items[i];id=item[this._fieldId];callback(item,id)}}else{for(id in data){if(data.hasOwnProperty(id)){item=this._getItem(id,type);if(!filter||filter(item)){callback(item,id)}}}}};DataSet.prototype.map=function(callback,options){var filter=options&&options.filter,type=options&&options.type||this._options.type,mappedItems=[],data=this._data,item;for(var id in data){if(data.hasOwnProperty(id)){item=this._getItem(id,type);if(!filter||filter(item)){mappedItems.push(callback(item,id))}}}if(options&&options.order){this._sort(mappedItems,options.order)}return mappedItems};DataSet.prototype._filterFields=function(item,fields){if(!item){return item}var filteredItem={};if(Array.isArray(fields)){for(var field in item){if(item.hasOwnProperty(field)&&fields.indexOf(field)!=-1){filteredItem[field]=item[field]}}}else{for(var field in item){if(item.hasOwnProperty(field)&&fields.hasOwnProperty(field)){filteredItem[fields[field]]=item[field]}}}return filteredItem};DataSet.prototype._sort=function(items,order){if(util.isString(order)){var name=order;items.sort(function(a,b){var av=a[name];var bv=b[name];return av>bv?1:av<bv?-1:0})}else if(typeof order==="function"){items.sort(order)}else{throw new TypeError("Order must be a function or a string")}};DataSet.prototype.remove=function(id,senderId){var removedIds=[],i,len,removedId;if(Array.isArray(id)){for(i=0,len=id.length;i<len;i++){removedId=this._remove(id[i]);if(removedId!=null){removedIds.push(removedId)}}}else{removedId=this._remove(id);if(removedId!=null){removedIds.push(removedId)}}if(removedIds.length){this._trigger("remove",{items:removedIds},senderId)}return removedIds};DataSet.prototype._remove=function(id){if(util.isNumber(id)||util.isString(id)){if(this._data[id]){delete this._data[id];this.length--;return id}}else if(id instanceof Object){var itemId=id[this._fieldId];if(itemId&&this._data[itemId]){delete this._data[itemId];this.length--;return itemId}}return null};DataSet.prototype.clear=function(senderId){var ids=Object.keys(this._data);this._data={};this.length=0;this._trigger("remove",{items:ids},senderId);return ids};DataSet.prototype.max=function(field){var data=this._data,max=null,maxField=null;for(var id in data){if(data.hasOwnProperty(id)){var item=data[id];var itemField=item[field];if(itemField!=null&&(!max||itemField>maxField)){max=item;maxField=itemField}}}return max};DataSet.prototype.min=function(field){var data=this._data,min=null,minField=null;for(var id in data){if(data.hasOwnProperty(id)){var item=data[id];var itemField=item[field];if(itemField!=null&&(!min||itemField<minField)){min=item;minField=itemField}}}return min};DataSet.prototype.distinct=function(field){var data=this._data;var values=[];var fieldType=this._options.type&&this._options.type[field]||null;var count=0;var i;for(var prop in data){if(data.hasOwnProperty(prop)){var item=data[prop];var value=item[field];var exists=false;for(i=0;i<count;i++){if(values[i]==value){exists=true;break}}if(!exists&&value!==undefined){values[count]=value;count++}}}if(fieldType){for(i=0;i<values.length;i++){values[i]=util.convert(values[i],fieldType)}}return values};DataSet.prototype._addItem=function(item){var id=item[this._fieldId];if(id!=undefined){if(this._data[id]){throw new Error("Cannot add item: item with id "+id+" already exists")}}else{id=util.randomUUID();item[this._fieldId]=id}var d={};for(var field in item){if(item.hasOwnProperty(field)){var fieldType=this._type[field];d[field]=util.convert(item[field],fieldType)}}this._data[id]=d;this.length++;return id};DataSet.prototype._getItem=function(id,types){var field,value;var raw=this._data[id];if(!raw){return null}var converted={};if(types){for(field in raw){if(raw.hasOwnProperty(field)){value=raw[field];converted[field]=util.convert(value,types[field])}}}else{for(field in raw){if(raw.hasOwnProperty(field)){value=raw[field];converted[field]=value}}}return converted};DataSet.prototype._updateItem=function(item){var id=item[this._fieldId];if(id==undefined){throw new Error("Cannot update item: item has no id (item: "+JSON.stringify(item)+")")}var d=this._data[id];if(!d){throw new Error("Cannot update item: no item with id "+id+" found")}for(var field in item){if(item.hasOwnProperty(field)){var fieldType=this._type[field];d[field]=util.convert(item[field],fieldType)}}return id};DataSet.prototype._getColumnNames=function(dataTable){var columns=[];for(var col=0,cols=dataTable.getNumberOfColumns();col<cols;col++){columns[col]=dataTable.getColumnId(col)||dataTable.getColumnLabel(col)}return columns};DataSet.prototype._appendRow=function(dataTable,columns,item){var row=dataTable.addRow();for(var col=0,cols=columns.length;col<cols;col++){var field=columns[col];dataTable.setValue(row,col,item[field])}};module.exports=DataSet},{"./Queue":4,"./util":28}],3:[function(require,module,exports){var util=require("./util");var DataSet=require("./DataSet");function DataView(data,options){this._data=null;this._ids={};this.length=0;this._options=options||{};this._fieldId="id";this._subscribers={};var me=this;this.listener=function(){me._onEvent.apply(me,arguments)};this.setData(data)}DataView.prototype.setData=function(data){var ids,i,len;if(this._data){if(this._data.unsubscribe){this._data.unsubscribe("*",this.listener)}ids=[];for(var id in this._ids){if(this._ids.hasOwnProperty(id)){ids.push(id)}}this._ids={};this.length=0;this._trigger("remove",{items:ids})}this._data=data;if(this._data){this._fieldId=this._options.fieldId||this._data&&this._data.options&&this._data.options.fieldId||"id";ids=this._data.getIds({filter:this._options&&this._options.filter});for(i=0,len=ids.length;i<len;i++){id=ids[i];this._ids[id]=true}this.length=ids.length;this._trigger("add",{items:ids});if(this._data.on){this._data.on("*",this.listener)}}};DataView.prototype.refresh=function(){var id;var ids=this._data.getIds({filter:this._options&&this._options.filter});var newIds={};var added=[];var removed=[];for(var i=0;i<ids.length;i++){id=ids[i];newIds[id]=true;if(!this._ids[id]){added.push(id);this._ids[id]=true;this.length++}}for(id in this._ids){if(this._ids.hasOwnProperty(id)){if(!newIds[id]){removed.push(id);delete this._ids[id];this.length--}}}if(added.length){this._trigger("add",{items:added})}if(removed.length){this._trigger("remove",{items:removed})}};DataView.prototype.get=function(args){var me=this;var ids,options,data;var firstType=util.getType(arguments[0]);if(firstType=="String"||firstType=="Number"||firstType=="Array"){ids=arguments[0];options=arguments[1];data=arguments[2]}else{options=arguments[0];data=arguments[1]}var viewOptions=util.extend({},this._options,options);if(this._options.filter&&options&&options.filter){viewOptions.filter=function(item){return me._options.filter(item)&&options.filter(item)}}var getArguments=[];if(ids!=undefined){getArguments.push(ids)}getArguments.push(viewOptions);getArguments.push(data);return this._data&&this._data.get.apply(this._data,getArguments)};DataView.prototype.getIds=function(options){var ids;if(this._data){var defaultFilter=this._options.filter;var filter;if(options&&options.filter){if(defaultFilter){filter=function(item){return defaultFilter(item)&&options.filter(item)}}else{filter=options.filter}}else{filter=defaultFilter}ids=this._data.getIds({filter:filter,order:options&&options.order})}else{ids=[]}return ids};DataView.prototype.getDataSet=function(){var dataSet=this;while(dataSet instanceof DataView){dataSet=dataSet._data}return dataSet||null};DataView.prototype._onEvent=function(event,params,senderId){var i,len,id,item;var ids=params&&params.items;var data=this._data;var updatedData=[];var added=[];var updated=[];var removed=[];if(ids&&data){switch(event){case"add":for(i=0,len=ids.length;i<len;i++){id=ids[i];item=this.get(id);if(item){this._ids[id]=true;added.push(id)}}break;case"update":for(i=0,len=ids.length;i<len;i++){id=ids[i];item=this.get(id);if(item){if(this._ids[id]){updated.push(id);updatedData.push(params.data[i])}else{this._ids[id]=true;added.push(id)}}else{if(this._ids[id]){delete this._ids[id];removed.push(id)}else{}}}break;case"remove":for(i=0,len=ids.length;i<len;i++){id=ids[i];if(this._ids[id]){delete this._ids[id];removed.push(id)}}break}this.length+=added.length-removed.length;if(added.length){this._trigger("add",{items:added},senderId)}if(updated.length){this._trigger("update",{items:updated,data:updatedData},senderId)}if(removed.length){this._trigger("remove",{items:removed},senderId)}}};DataView.prototype.on=DataSet.prototype.on;DataView.prototype.off=DataSet.prototype.off;DataView.prototype._trigger=DataSet.prototype._trigger;DataView.prototype.subscribe=DataView.prototype.on;DataView.prototype.unsubscribe=DataView.prototype.off;module.exports=DataView},{"./DataSet":2,"./util":28}],4:[function(require,module,exports){function Queue(options){this.delay=null;this.max=Infinity;this._queue=[];this._timeout=null;this._extended=null;this.setOptions(options)}Queue.prototype.setOptions=function(options){if(options&&typeof options.delay!=="undefined"){this.delay=options.delay}if(options&&typeof options.max!=="undefined"){this.max=options.max}this._flushIfNeeded()};Queue.extend=function(object,options){var queue=new Queue(options);if(object.flush!==undefined){throw new Error("Target object already has a property flush")}object.flush=function(){queue.flush()};var methods=[{name:"flush",original:undefined}];if(options&&options.replace){for(var i=0;i<options.replace.length;i++){var name=options.replace[i];methods.push({name:name,original:object[name]});queue.replace(object,name)}}queue._extended={object:object,methods:methods};return queue};Queue.prototype.destroy=function(){this.flush();if(this._extended){var object=this._extended.object;var methods=this._extended.methods;for(var i=0;i<methods.length;i++){var method=methods[i];if(method.original){object[method.name]=method.original}else{delete object[method.name]}}this._extended=null}};Queue.prototype.replace=function(object,method){var me=this;var original=object[method];if(!original){throw new Error("Method "+method+" undefined")}object[method]=function(){var args=[];for(var i=0;i<arguments.length;i++){args[i]=arguments[i]}me.queue({args:args,fn:original,context:this})}};Queue.prototype.queue=function(entry){if(typeof entry==="function"){this._queue.push({fn:entry})}else{this._queue.push(entry)}this._flushIfNeeded()};Queue.prototype._flushIfNeeded=function(){if(this._queue.length>this.max){this.flush()}clearTimeout(this._timeout);if(this.queue.length>0&&typeof this.delay==="number"){var me=this;this._timeout=setTimeout(function(){me.flush()},this.delay)}};Queue.prototype.flush=function(){while(this._queue.length>0){var entry=this._queue.shift();entry.fn.apply(entry.context||entry.fn,entry.args||[])}};module.exports=Queue},{}],5:[function(require,module,exports){var Hammer=require("./module/hammer");exports.fakeGesture=function(element,event){var eventType=null;var touches=Hammer.event.getTouchList(event,eventType);var gesture=Hammer.event.collectEventData(this,eventType,touches,event);if(isNaN(gesture.center.pageX)){gesture.center.pageX=event.pageX}if(isNaN(gesture.center.pageY)){gesture.center.pageY=event.pageY}return gesture}},{"./module/hammer":6}],6:[function(require,module,exports){if(typeof window!=="undefined"){module.exports=window["Hammer"]||require("hammerjs")}else{module.exports=function(){throw Error("hammer.js is only available in a browser, not in node.js.")}}},{hammerjs:"hammerjs"}],7:[function(require,module,exports){module.exports=typeof window!=="undefined"&&window["moment"]||require("moment")},{moment:"moment"}],8:[function(require,module,exports){var keycharm=require("keycharm");var Emitter=require("emitter-component");var Hammer=require("../module/hammer");var util=require("../util");function Activator(container){this.active=false;this.dom={container:container};this.dom.overlay=document.createElement("div");this.dom.overlay.className="overlay";this.dom.container.appendChild(this.dom.overlay);this.hammer=Hammer(this.dom.overlay,{prevent_default:false});this.hammer.on("tap",this._onTapOverlay.bind(this));var me=this;var events=["touch","pinch","doubletap","hold","dragstart","drag","dragend","mousewheel","DOMMouseScroll"];events.forEach(function(event){me.hammer.on(event,function(event){event.stopPropagation()})});this.windowHammer=Hammer(window,{prevent_default:false});this.windowHammer.on("tap",function(event){if(!_hasParent(event.target,container)){me.deactivate()}});if(this.keycharm!==undefined){this.keycharm.destroy()}this.keycharm=keycharm();this.escListener=this.deactivate.bind(this)}Emitter(Activator.prototype);Activator.current=null;Activator.prototype.destroy=function(){this.deactivate();this.dom.overlay.parentNode.removeChild(this.dom.overlay);this.hammer=null;this.windowHammer=null};Activator.prototype.activate=function(){if(Activator.current){Activator.current.deactivate()}Activator.current=this;this.active=true;this.dom.overlay.style.display="none";util.addClassName(this.dom.container,"vis-active");this.emit("change");this.emit("activate");this.keycharm.bind("esc",this.escListener)};Activator.prototype.deactivate=function(){this.active=false;this.dom.overlay.style.display="";util.removeClassName(this.dom.container,"vis-active");this.keycharm.unbind("esc",this.escListener);this.emit("change");this.emit("deactivate")};Activator.prototype._onTapOverlay=function(event){this.activate();event.stopPropagation()};function _hasParent(element,parent){while(element){if(element===parent){return true}element=element.parentNode}return false}module.exports=Activator},{"../module/hammer":6,"../util":28,"emitter-component":29,keycharm:30}],9:[function(require,module,exports){var Emitter=require("emitter-component");var Hammer=require("../module/hammer");var util=require("../util");var DataSet=require("../DataSet");var DataView=require("../DataView");var Range=require("./Range");var ItemSet=require("./component/ItemSet");var TimeAxis=require("./component/TimeAxis");var Activator=require("../shared/Activator");var DateUtil=require("./DateUtil");var CustomTime=require("./component/CustomTime");function Core(){}Emitter(Core.prototype);Core.prototype._create=function(container){this.dom={};this.dom.root=document.createElement("div");this.dom.background=document.createElement("div");this.dom.backgroundVertical=document.createElement("div");this.dom.backgroundHorizontal=document.createElement("div");this.dom.centerContainer=document.createElement("div");this.dom.leftContainer=document.createElement("div");this.dom.rightContainer=document.createElement("div");this.dom.center=document.createElement("div");this.dom.left=document.createElement("div");this.dom.right=document.createElement("div");this.dom.top=document.createElement("div");this.dom.bottom=document.createElement("div");this.dom.shadowTop=document.createElement("div");this.dom.shadowBottom=document.createElement("div");this.dom.shadowTopLeft=document.createElement("div");this.dom.shadowBottomLeft=document.createElement("div");this.dom.shadowTopRight=document.createElement("div");this.dom.shadowBottomRight=document.createElement("div");this.dom.root.className="vis timeline root";this.dom.background.className="vispanel background";this.dom.backgroundVertical.className="vispanel background vertical";this.dom.backgroundHorizontal.className="vispanel background horizontal";this.dom.centerContainer.className="vispanel center";this.dom.leftContainer.className="vispanel left";this.dom.rightContainer.className="vispanel right";this.dom.top.className="vispanel top";this.dom.bottom.className="vispanel bottom";this.dom.left.className="content";this.dom.center.className="content";this.dom.right.className="content";this.dom.shadowTop.className="shadow top";this.dom.shadowBottom.className="shadow bottom";this.dom.shadowTopLeft.className="shadow top";this.dom.shadowBottomLeft.className="shadow bottom";this.dom.shadowTopRight.className="shadow top";this.dom.shadowBottomRight.className="shadow bottom";this.dom.root.appendChild(this.dom.background);this.dom.root.appendChild(this.dom.backgroundVertical);this.dom.root.appendChild(this.dom.backgroundHorizontal);this.dom.root.appendChild(this.dom.centerContainer);this.dom.root.appendChild(this.dom.leftContainer);this.dom.root.appendChild(this.dom.rightContainer);this.dom.root.appendChild(this.dom.top);this.dom.root.appendChild(this.dom.bottom);this.dom.centerContainer.appendChild(this.dom.center);this.dom.leftContainer.appendChild(this.dom.left);this.dom.rightContainer.appendChild(this.dom.right);this.dom.centerContainer.appendChild(this.dom.shadowTop);this.dom.centerContainer.appendChild(this.dom.shadowBottom);this.dom.leftContainer.appendChild(this.dom.shadowTopLeft);this.dom.leftContainer.appendChild(this.dom.shadowBottomLeft);this.dom.rightContainer.appendChild(this.dom.shadowTopRight);this.dom.rightContainer.appendChild(this.dom.shadowBottomRight);this.on("rangechange",this._redraw.bind(this));this.on("touch",this._onTouch.bind(this));this.on("pinch",this._onPinch.bind(this));this.on("dragstart",this._onDragStart.bind(this));this.on("drag",this._onDrag.bind(this));var me=this;this.on("change",function(properties){if(properties&&properties.queue==true){if(!me._redrawTimer){me._redrawTimer=setTimeout(function(){me._redrawTimer=null;me._redraw()},0)}}else{me._redraw()}});this.hammer=Hammer(this.dom.root,{preventDefault:true});this.listeners={};var events=["touch","pinch","tap","doubletap","hold","dragstart","drag","dragend","mousewheel","DOMMouseScroll"];events.forEach(function(event){var listener=function(){var args=[event].concat(Array.prototype.slice.call(arguments,0));if(me.isActive()){me.emit.apply(me,args)}};me.hammer.on(event,listener);me.listeners[event]=listener});this.props={root:{},background:{},centerContainer:{},leftContainer:{},rightContainer:{},center:{},left:{},right:{},top:{},bottom:{},border:{},scrollTop:0,scrollTopMin:0};this.touch={};this.redrawCount=0;if(!container)throw new Error("No container provided");container.appendChild(this.dom.root)};Core.prototype.setOptions=function(options){if(options){var fields=["width","height","minHeight","maxHeight","autoResize","start","end","clickToUse","dataAttributes","hiddenDates"];util.selectiveExtend(fields,this.options,options);if("orientation"in options){if(typeof options.orientation==="string"){this.options.orientation=options.orientation}else if(typeof options.orientation==="object"&&"axis"in options.orientation){this.options.orientation=options.orientation.axis}}if(this.options.orientation==="both"){if(!this.timeAxis2){var timeAxis2=this.timeAxis2=new TimeAxis(this.body);timeAxis2.setOptions=function(options){var _options=options?util.extend({},options):{};_options.orientation="top";TimeAxis.prototype.setOptions.call(timeAxis2,_options)};this.components.push(timeAxis2)}}else{if(this.timeAxis2){var index=this.components.indexOf(this.timeAxis2);if(index!==-1){this.components.splice(index,1)}this.timeAxis2.destroy();this.timeAxis2=null}}if("hiddenDates"in this.options){DateUtil.convertHiddenOptions(this.body,this.options.hiddenDates)}if("clickToUse"in options){if(options.clickToUse){if(!this.activator){this.activator=new Activator(this.dom.root)}}else{if(this.activator){this.activator.destroy();delete this.activator}}}this._initAutoResize()}this.components.forEach(function(component){component.setOptions(options)});this._redraw()};Core.prototype.isActive=function(){return!this.activator||this.activator.active};Core.prototype.destroy=function(){this.clear();this.off();this._stopAutoResize();if(this.dom.root.parentNode){this.dom.root.parentNode.removeChild(this.dom.root)}this.dom=null;if(this.activator){this.activator.destroy();delete this.activator}for(var event in this.listeners){if(this.listeners.hasOwnProperty(event)){delete this.listeners[event]}}this.listeners=null;this.hammer=null;this.components.forEach(function(component){component.destroy()});this.body=null};Core.prototype.setCustomTime=function(time,id){var barId=id||0;this.components.forEach(function(element,index,components){if(element instanceof CustomTime&&element.options.id===barId){element.setCustomTime(time)}})};Core.prototype.getCustomTime=function(id){var barId=id||0;customTime=null;this.components.forEach(function(element,index,components){if(element instanceof CustomTime&&element.options.id===barId){customTime=element.getCustomTime()}});return customTime};Core.prototype.addCustomTime=function(time,cssClass,id){if(time===undefined){throw new Error("Time parameter for the custom bar must be provided")}var ts=util.convert(time,"Date").valueOf(),numIds,customTime,customBarId;if(!this.customBarIds||this.customBarIds.constructor!==Array){this.customBarIds=[0]}if(id===undefined){numIds=this.customBarIds.filter(function(element){return util.isNumber(element)});customBarId=numIds.length>0?Math.max.apply(null,numIds)+1:0}else{this.customBarIds.forEach(function(element){if(element===id){throw new Error("Custom time ID already exists")}});customBarId=id}this.customBarIds.push(customBarId);customTime=new CustomTime(this.body,{showCustomTime:true,time:ts,id:customBarId,cssClass:cssClass});this.components.push(customTime);this.redraw();return customBarId};Core.prototype.removeCustomTime=function(id){var me=this;this.components.forEach(function(bar,index,components){if(bar instanceof CustomTime&&bar.options.id===id){if(bar.options.id!==0){me.customBarIds.splice(me.customBarIds.indexOf(id),1);components.splice(index,1);bar.destroy()}}})};Core.prototype.getVisibleItems=function(){return this.itemSet&&this.itemSet.getVisibleItems()||[]};Core.prototype.clear=function(what){if(!what||what.items){this.setItems(null)}if(!what||what.groups){this.setGroups(null)}if(!what||what.options){this.components.forEach(function(component){component.setOptions(component.defaultOptions)});this.setOptions(this.defaultOptions)}};Core.prototype.fit=function(options){var range=this._getDataRange();if(range.start===null&&range.end===null){return}var animate=options&&options.animate!==undefined?options.animate:true;this.range.setRange(range.start,range.end,animate)};Core.prototype._getDataRange=function(){var dataRange=this.getItemRange();var start=dataRange.min;var end=dataRange.max;if(start!=null&&end!=null){var interval=end.valueOf()-start.valueOf();if(interval<=0){interval=24*60*60*1e3}start=new Date(start.valueOf()-interval*.05);end=new Date(end.valueOf()+interval*.05)}return{start:start,end:end}};Core.prototype.setWindow=function(start,end,options){var animate;if(arguments.length==1){var range=arguments[0];animate=range.animate!==undefined?range.animate:true;this.range.setRange(range.start,range.end,animate)}else{animate=options&&options.animate!==undefined?options.animate:true;this.range.setRange(start,end,animate)}};Core.prototype.moveTo=function(time,options){var interval=this.range.end-this.range.start;var t=util.convert(time,"Date").valueOf();var start=t-interval/2;var end=t+interval/2;var animate=options&&options.animate!==undefined?options.animate:true;this.range.setRange(start,end,animate)};Core.prototype.getWindow=function(){var range=this.range.getRange();return{start:new Date(range.start),end:new Date(range.end)}};Core.prototype.redraw=function(){this._redraw()};Core.prototype._redraw=function(){var resized=false;var options=this.options;var props=this.props;var dom=this.dom;if(!dom)return;DateUtil.updateHiddenDates(this.body,this.options.hiddenDates);if(options.orientation=="top"){util.addClassName(dom.root,"top");util.removeClassName(dom.root,"bottom")}else{util.removeClassName(dom.root,"top");util.addClassName(dom.root,"bottom")}dom.root.style.maxHeight=util.option.asSize(options.maxHeight,"");dom.root.style.minHeight=util.option.asSize(options.minHeight,"");dom.root.style.width=util.option.asSize(options.width,"");props.border.left=(dom.centerContainer.offsetWidth-dom.centerContainer.clientWidth)/2;props.border.right=props.border.left;props.border.top=(dom.centerContainer.offsetHeight-dom.centerContainer.clientHeight)/2;props.border.bottom=props.border.top;

var borderRootHeight=dom.root.offsetHeight-dom.root.clientHeight;var borderRootWidth=dom.root.offsetWidth-dom.root.clientWidth;if(dom.centerContainer.clientHeight===0){props.border.left=props.border.top;props.border.right=props.border.left}if(dom.root.clientHeight===0){borderRootWidth=borderRootHeight}props.center.height=dom.center.offsetHeight;props.left.height=dom.left.offsetHeight;props.right.height=dom.right.offsetHeight;props.top.height=dom.top.clientHeight||-props.border.top;props.bottom.height=dom.bottom.clientHeight||-props.border.bottom;var contentHeight=Math.max(props.left.height,props.center.height,props.right.height);var autoHeight=props.top.height+contentHeight+props.bottom.height+borderRootHeight+props.border.top+props.border.bottom;dom.root.style.height=util.option.asSize(options.height,autoHeight+"px");props.root.height=dom.root.offsetHeight;props.background.height=props.root.height-borderRootHeight;var containerHeight=props.root.height-props.top.height-props.bottom.height-borderRootHeight;props.centerContainer.height=containerHeight;props.leftContainer.height=containerHeight;props.rightContainer.height=props.leftContainer.height;props.root.width=dom.root.offsetWidth;props.background.width=props.root.width-borderRootWidth;props.left.width=dom.leftContainer.clientWidth||-props.border.left;props.leftContainer.width=props.left.width;props.right.width=dom.rightContainer.clientWidth||-props.border.right;props.rightContainer.width=props.right.width;var centerWidth=props.root.width-props.left.width-props.right.width-borderRootWidth;props.center.width=centerWidth;props.centerContainer.width=centerWidth;props.top.width=centerWidth;props.bottom.width=centerWidth;dom.background.style.height=props.background.height+"px";dom.backgroundVertical.style.height=props.background.height+"px";dom.backgroundHorizontal.style.height=props.centerContainer.height+"px";dom.centerContainer.style.height=props.centerContainer.height+"px";dom.leftContainer.style.height=props.leftContainer.height+"px";dom.rightContainer.style.height=props.rightContainer.height+"px";dom.background.style.width=props.background.width+"px";dom.backgroundVertical.style.width=props.centerContainer.width+"px";dom.backgroundHorizontal.style.width=props.background.width+"px";dom.centerContainer.style.width=props.center.width+"px";dom.top.style.width=props.top.width+"px";dom.bottom.style.width=props.bottom.width+"px";dom.background.style.left="0";dom.background.style.top="0";dom.backgroundVertical.style.left=props.left.width+props.border.left+"px";dom.backgroundVertical.style.top="0";dom.backgroundHorizontal.style.left="0";dom.backgroundHorizontal.style.top=props.top.height+"px";dom.centerContainer.style.left=props.left.width+"px";dom.centerContainer.style.top=props.top.height+"px";dom.leftContainer.style.left="0";dom.leftContainer.style.top=props.top.height+"px";dom.rightContainer.style.left=props.left.width+props.center.width+"px";dom.rightContainer.style.top=props.top.height+"px";dom.top.style.left=props.left.width+"px";dom.top.style.top="0";dom.bottom.style.left=props.left.width+"px";dom.bottom.style.top=props.top.height+props.centerContainer.height+"px";this._updateScrollTop();var offset=this.props.scrollTop;if(options.orientation=="bottom"){offset+=Math.max(this.props.centerContainer.height-this.props.center.height-this.props.border.top-this.props.border.bottom,0)}dom.center.style.left="0";dom.center.style.top=offset+"px";dom.left.style.left="0";dom.left.style.top=offset+"px";dom.right.style.left="0";dom.right.style.top=offset+"px";var visibilityTop=this.props.scrollTop==0?"hidden":"";var visibilityBottom=this.props.scrollTop==this.props.scrollTopMin?"hidden":"";dom.shadowTop.style.visibility=visibilityTop;dom.shadowBottom.style.visibility=visibilityBottom;dom.shadowTopLeft.style.visibility=visibilityTop;dom.shadowBottomLeft.style.visibility=visibilityBottom;dom.shadowTopRight.style.visibility=visibilityTop;dom.shadowBottomRight.style.visibility=visibilityBottom;this.components.forEach(function(component){resized=component.redraw()||resized});if(resized){var MAX_REDRAWS=3;if(this.redrawCount<MAX_REDRAWS){this.redrawCount++;this._redraw()}else{console.log("WARNING: infinite loop in redraw?")}this.redrawCount=0}this.emit("finishedRedraw")};Core.prototype.repaint=function(){throw new Error("Function repaint is deprecated. Use redraw instead.")};Core.prototype.setCurrentTime=function(time){if(!this.currentTime){throw new Error("Option showCurrentTime must be true")}this.currentTime.setCurrentTime(time)};Core.prototype.getCurrentTime=function(){if(!this.currentTime){throw new Error("Option showCurrentTime must be true")}return this.currentTime.getCurrentTime()};Core.prototype._toTime=function(x){return DateUtil.toTime(this,x,this.props.center.width)};Core.prototype._toGlobalTime=function(x){return DateUtil.toTime(this,x,this.props.root.width)};Core.prototype._toScreen=function(time){return DateUtil.toScreen(this,time,this.props.center.width)};Core.prototype._toGlobalScreen=function(time){return DateUtil.toScreen(this,time,this.props.root.width)};Core.prototype._initAutoResize=function(){if(this.options.autoResize==true){this._startAutoResize()}else{this._stopAutoResize()}};Core.prototype._startAutoResize=function(){var me=this;this._stopAutoResize();this._onResize=function(){if(me.options.autoResize!=true){me._stopAutoResize();return}if(me.dom.root){if(me.dom.root.offsetWidth!=me.props.lastWidth||me.dom.root.offsetHeight!=me.props.lastHeight){me.props.lastWidth=me.dom.root.offsetWidth;me.props.lastHeight=me.dom.root.offsetHeight;me.emit("change")}}};util.addEventListener(window,"resize",this._onResize);this.watchTimer=setInterval(this._onResize,1e3)};Core.prototype._stopAutoResize=function(){if(this.watchTimer){clearInterval(this.watchTimer);this.watchTimer=undefined}util.removeEventListener(window,"resize",this._onResize);this._onResize=null};Core.prototype._onTouch=function(event){this.touch.allowDragging=true};Core.prototype._onPinch=function(event){this.touch.allowDragging=false};Core.prototype._onDragStart=function(event){this.touch.initialScrollTop=this.props.scrollTop};Core.prototype._onDrag=function(event){if(!this.touch.allowDragging)return;var delta=event.gesture.deltaY;var oldScrollTop=this._getScrollTop();var newScrollTop=this._setScrollTop(this.touch.initialScrollTop+delta);if(newScrollTop!=oldScrollTop){this._redraw();this.emit("verticalDrag")}};Core.prototype._setScrollTop=function(scrollTop){this.props.scrollTop=scrollTop;this._updateScrollTop();return this.props.scrollTop};Core.prototype._updateScrollTop=function(){var scrollTopMin=Math.min(this.props.centerContainer.height-this.props.center.height,0);if(scrollTopMin!=this.props.scrollTopMin){if(this.options.orientation=="bottom"){this.props.scrollTop+=scrollTopMin-this.props.scrollTopMin}this.props.scrollTopMin=scrollTopMin}if(this.props.scrollTop>0)this.props.scrollTop=0;if(this.props.scrollTop<scrollTopMin)this.props.scrollTop=scrollTopMin;return this.props.scrollTop};Core.prototype._getScrollTop=function(){return this.props.scrollTop};module.exports=Core},{"../DataSet":2,"../DataView":3,"../module/hammer":6,"../shared/Activator":8,"../util":28,"./DateUtil":10,"./Range":11,"./component/CustomTime":18,"./component/ItemSet":20,"./component/TimeAxis":21,"emitter-component":29}],10:[function(require,module,exports){var moment=require("../module/moment");exports.convertHiddenOptions=function(body,hiddenDates){body.hiddenDates=[];if(hiddenDates){if(Array.isArray(hiddenDates)==true){for(var i=0;i<hiddenDates.length;i++){if(hiddenDates[i].repeat===undefined){var dateItem={};dateItem.start=moment(hiddenDates[i].start).toDate().valueOf();dateItem.end=moment(hiddenDates[i].end).toDate().valueOf();body.hiddenDates.push(dateItem)}}body.hiddenDates.sort(function(a,b){return a.start-b.start})}}};exports.updateHiddenDates=function(body,hiddenDates){if(hiddenDates&&body.domProps.centerContainer.width!==undefined){exports.convertHiddenOptions(body,hiddenDates);var start=moment(body.range.start);var end=moment(body.range.end);var totalRange=body.range.end-body.range.start;var pixelTime=totalRange/body.domProps.centerContainer.width;for(var i=0;i<hiddenDates.length;i++){if(hiddenDates[i].repeat!==undefined){var startDate=moment(hiddenDates[i].start);var endDate=moment(hiddenDates[i].end);if(startDate._d=="Invalid Date"){throw new Error("Supplied start date is not valid: "+hiddenDates[i].start)}if(endDate._d=="Invalid Date"){throw new Error("Supplied end date is not valid: "+hiddenDates[i].end)}var duration=endDate-startDate;if(duration>=4*pixelTime){var offset=0;var runUntil=end.clone();switch(hiddenDates[i].repeat){case"daily":if(startDate.day()!=endDate.day()){offset=1}startDate.dayOfYear(start.dayOfYear());startDate.year(start.year());startDate.subtract(7,"days");endDate.dayOfYear(start.dayOfYear());endDate.year(start.year());endDate.subtract(7-offset,"days");runUntil.add(1,"weeks");break;case"weekly":var dayOffset=endDate.diff(startDate,"days");var day=startDate.day();startDate.date(start.date());startDate.month(start.month());startDate.year(start.year());endDate=startDate.clone();startDate.day(day);endDate.day(day);endDate.add(dayOffset,"days");startDate.subtract(1,"weeks");endDate.subtract(1,"weeks");runUntil.add(1,"weeks");break;case"monthly":if(startDate.month()!=endDate.month()){offset=1}startDate.month(start.month());startDate.year(start.year());startDate.subtract(1,"months");endDate.month(start.month());endDate.year(start.year());endDate.subtract(1,"months");endDate.add(offset,"months");runUntil.add(1,"months");break;case"yearly":if(startDate.year()!=endDate.year()){offset=1}startDate.year(start.year());startDate.subtract(1,"years");endDate.year(start.year());endDate.subtract(1,"years");endDate.add(offset,"years");runUntil.add(1,"years");break;default:console.log("Wrong repeat format, allowed are: daily, weekly, monthly, yearly. Given:",hiddenDates[i].repeat);return}while(startDate<runUntil){body.hiddenDates.push({start:startDate.valueOf(),end:endDate.valueOf()});switch(hiddenDates[i].repeat){case"daily":startDate.add(1,"days");endDate.add(1,"days");break;case"weekly":startDate.add(1,"weeks");endDate.add(1,"weeks");break;case"monthly":startDate.add(1,"months");endDate.add(1,"months");break;case"yearly":startDate.add(1,"y");endDate.add(1,"y");break;default:console.log("Wrong repeat format, allowed are: daily, weekly, monthly, yearly. Given:",hiddenDates[i].repeat);return}}body.hiddenDates.push({start:startDate.valueOf(),end:endDate.valueOf()})}}}exports.removeDuplicates(body);var startHidden=exports.isHidden(body.range.start,body.hiddenDates);var endHidden=exports.isHidden(body.range.end,body.hiddenDates);var rangeStart=body.range.start;var rangeEnd=body.range.end;if(startHidden.hidden==true){rangeStart=body.range.startToFront==true?startHidden.startDate-1:startHidden.endDate+1}if(endHidden.hidden==true){rangeEnd=body.range.endToFront==true?endHidden.startDate-1:endHidden.endDate+1}if(startHidden.hidden==true||endHidden.hidden==true){body.range._applyRange(rangeStart,rangeEnd)}}};exports.removeDuplicates=function(body){var hiddenDates=body.hiddenDates;var safeDates=[];for(var i=0;i<hiddenDates.length;i++){for(var j=0;j<hiddenDates.length;j++){if(i!=j&&hiddenDates[j].remove!=true&&hiddenDates[i].remove!=true){if(hiddenDates[j].start>=hiddenDates[i].start&&hiddenDates[j].end<=hiddenDates[i].end){hiddenDates[j].remove=true}else if(hiddenDates[j].start>=hiddenDates[i].start&&hiddenDates[j].start<=hiddenDates[i].end){hiddenDates[i].end=hiddenDates[j].end;hiddenDates[j].remove=true}else if(hiddenDates[j].end>=hiddenDates[i].start&&hiddenDates[j].end<=hiddenDates[i].end){hiddenDates[i].start=hiddenDates[j].start;hiddenDates[j].remove=true}}}}for(var i=0;i<hiddenDates.length;i++){if(hiddenDates[i].remove!==true){safeDates.push(hiddenDates[i])}}body.hiddenDates=safeDates;body.hiddenDates.sort(function(a,b){return a.start-b.start})};exports.printDates=function(dates){for(var i=0;i<dates.length;i++){console.log(i,new Date(dates[i].start),new Date(dates[i].end),dates[i].start,dates[i].end,dates[i].remove)}};exports.stepOverHiddenDates=function(timeStep,previousTime){var stepInHidden=false;var currentValue=timeStep.current.valueOf();for(var i=0;i<timeStep.hiddenDates.length;i++){var startDate=timeStep.hiddenDates[i].start;var endDate=timeStep.hiddenDates[i].end;if(currentValue>=startDate&&currentValue<endDate){stepInHidden=true;break}}if(stepInHidden==true&&currentValue<timeStep._end.valueOf()&&currentValue!=previousTime){var prevValue=moment(previousTime);var newValue=moment(endDate);if(prevValue.year()!=newValue.year()){timeStep.switchedYear=true}else if(prevValue.month()!=newValue.month()){timeStep.switchedMonth=true}else if(prevValue.dayOfYear()!=newValue.dayOfYear()){timeStep.switchedDay=true}timeStep.current=newValue.toDate()}};exports.toScreen=function(Core,time,width){if(Core.body.hiddenDates.length==0){var conversion=Core.range.conversion(width);return(time.valueOf()-conversion.offset)*conversion.scale}else{var hidden=exports.isHidden(time,Core.body.hiddenDates);if(hidden.hidden==true){time=hidden.startDate}var duration=exports.getHiddenDurationBetween(Core.body.hiddenDates,Core.range.start,Core.range.end);time=exports.correctTimeForHidden(Core.body.hiddenDates,Core.range,time);var conversion=Core.range.conversion(width,duration);return(time.valueOf()-conversion.offset)*conversion.scale}};exports.toTime=function(Core,x,width){if(Core.body.hiddenDates.length==0){var conversion=Core.range.conversion(width);return new Date(x/conversion.scale+conversion.offset)}else{var hiddenDuration=exports.getHiddenDurationBetween(Core.body.hiddenDates,Core.range.start,Core.range.end);var totalDuration=Core.range.end-Core.range.start-hiddenDuration;var partialDuration=totalDuration*x/width;var accumulatedHiddenDuration=exports.getAccumulatedHiddenDuration(Core.body.hiddenDates,Core.range,partialDuration);var newTime=new Date(accumulatedHiddenDuration+partialDuration+Core.range.start);return newTime}};exports.getHiddenDurationBetween=function(hiddenDates,start,end){var duration=0;for(var i=0;i<hiddenDates.length;i++){var startDate=hiddenDates[i].start;var endDate=hiddenDates[i].end;if(startDate>=start&&endDate<end){duration+=endDate-startDate}}return duration};exports.correctTimeForHidden=function(hiddenDates,range,time){time=moment(time).toDate().valueOf();time-=exports.getHiddenDurationBefore(hiddenDates,range,time);return time};exports.getHiddenDurationBefore=function(hiddenDates,range,time){var timeOffset=0;time=moment(time).toDate().valueOf();for(var i=0;i<hiddenDates.length;i++){var startDate=hiddenDates[i].start;var endDate=hiddenDates[i].end;if(startDate>=range.start&&endDate<range.end){if(time>=endDate){timeOffset+=endDate-startDate}}}return timeOffset};exports.getAccumulatedHiddenDuration=function(hiddenDates,range,requiredDuration){var hiddenDuration=0;var duration=0;var previousPoint=range.start;for(var i=0;i<hiddenDates.length;i++){var startDate=hiddenDates[i].start;var endDate=hiddenDates[i].end;if(startDate>=range.start&&endDate<range.end){duration+=startDate-previousPoint;previousPoint=endDate;if(duration>=requiredDuration){break}else{hiddenDuration+=endDate-startDate}}}return hiddenDuration};exports.snapAwayFromHidden=function(hiddenDates,time,direction,correctionEnabled){var isHidden=exports.isHidden(time,hiddenDates);if(isHidden.hidden==true){if(direction<0){if(correctionEnabled==true){return isHidden.startDate-(isHidden.endDate-time)-1}else{return isHidden.startDate-1}}else{if(correctionEnabled==true){return isHidden.endDate+(time-isHidden.startDate)+1}else{return isHidden.endDate+1}}}else{return time}};exports.isHidden=function(time,hiddenDates){for(var i=0;i<hiddenDates.length;i++){var startDate=hiddenDates[i].start;var endDate=hiddenDates[i].end;if(time>=startDate&&time<endDate){return{hidden:true,startDate:startDate,endDate:endDate};break}}return{hidden:false,startDate:startDate,endDate:endDate}}},{"../module/moment":7}],11:[function(require,module,exports){var util=require("../util");var hammerUtil=require("../hammerUtil");var moment=require("../module/moment");var Component=require("./component/Component");var DateUtil=require("./DateUtil");function Range(body,options){var now=moment().hours(0).minutes(0).seconds(0).milliseconds(0);this.start=now.clone().add(-3,"days").valueOf();this.end=now.clone().add(4,"days").valueOf();this.body=body;this.deltaDifference=0;this.scaleOffset=0;this.startToFront=false;this.endToFront=true;this.defaultOptions={start:null,end:null,direction:"horizontal",moveable:true,zoomable:true,min:null,max:null,zoomMin:10,zoomMax:1e3*60*60*24*365*1e4};this.options=util.extend({},this.defaultOptions);this.props={touch:{}};this.animateTimer=null;this.body.emitter.on("dragstart",this._onDragStart.bind(this));this.body.emitter.on("drag",this._onDrag.bind(this));this.body.emitter.on("dragend",this._onDragEnd.bind(this));this.body.emitter.on("hold",this._onHold.bind(this));this.body.emitter.on("mousewheel",this._onMouseWheel.bind(this));this.body.emitter.on("DOMMouseScroll",this._onMouseWheel.bind(this));this.body.emitter.on("touch",this._onTouch.bind(this));this.body.emitter.on("pinch",this._onPinch.bind(this));this.setOptions(options)}Range.prototype=new Component;Range.prototype.setOptions=function(options){if(options){var fields=["direction","min","max","zoomMin","zoomMax","moveable","zoomable","activate","hiddenDates"];util.selectiveExtend(fields,this.options,options);if("start"in options||"end"in options){this.setRange(options.start,options.end)}}};function validateDirection(direction){if(direction!="horizontal"&&direction!="vertical"){throw new TypeError('Unknown direction "'+direction+'". '+'Choose "horizontal" or "vertical".')}}Range.prototype.setRange=function(start,end,animate,byUser){if(byUser!==true){byUser=false}var _start=start!=undefined?util.convert(start,"Date").valueOf():null;var _end=end!=undefined?util.convert(end,"Date").valueOf():null;this._cancelAnimation();if(animate){var me=this;var initStart=this.start;var initEnd=this.end;var duration=typeof animate==="number"?animate:500;var initTime=(new Date).valueOf();var anyChanged=false;var next=function(){if(!me.props.touch.dragging){var now=(new Date).valueOf();var time=now-initTime;var done=time>duration;var s=done||_start===null?_start:util.easeInOutQuad(time,initStart,_start,duration);var e=done||_end===null?_end:util.easeInOutQuad(time,initEnd,_end,duration);changed=me._applyRange(s,e);DateUtil.updateHiddenDates(me.body,me.options.hiddenDates);anyChanged=anyChanged||changed;if(changed){me.body.emitter.emit("rangechange",{start:new Date(me.start),end:new Date(me.end),byUser:byUser})}if(done){if(anyChanged){me.body.emitter.emit("rangechanged",{start:new Date(me.start),end:new Date(me.end),byUser:byUser})}}else{me.animateTimer=setTimeout(next,20)}}};return next()}else{var changed=this._applyRange(_start,_end);DateUtil.updateHiddenDates(this.body,this.options.hiddenDates);if(changed){var params={start:new Date(this.start),end:new Date(this.end),byUser:byUser};this.body.emitter.emit("rangechange",params);this.body.emitter.emit("rangechanged",params)}}};Range.prototype._cancelAnimation=function(){if(this.animateTimer){clearTimeout(this.animateTimer);this.animateTimer=null}};Range.prototype._applyRange=function(start,end){var newStart=start!=null?util.convert(start,"Date").valueOf():this.start,newEnd=end!=null?util.convert(end,"Date").valueOf():this.end,max=this.options.max!=null?util.convert(this.options.max,"Date").valueOf():null,min=this.options.min!=null?util.convert(this.options.min,"Date").valueOf():null,diff;if(isNaN(newStart)||newStart===null){throw new Error('Invalid start "'+start+'"')}if(isNaN(newEnd)||newEnd===null){throw new Error('Invalid end "'+end+'"')}if(newEnd<newStart){newEnd=newStart}if(min!==null){if(newStart<min){diff=min-newStart;newStart+=diff;newEnd+=diff;if(max!=null){if(newEnd>max){newEnd=max}}}}if(max!==null){if(newEnd>max){diff=newEnd-max;newStart-=diff;newEnd-=diff;if(min!=null){if(newStart<min){newStart=min}}}}if(this.options.zoomMin!==null){var zoomMin=parseFloat(this.options.zoomMin);if(zoomMin<0){zoomMin=0}if(newEnd-newStart<zoomMin){if(this.end-this.start===zoomMin&&newStart>this.start&&newEnd<this.end){newStart=this.start;newEnd=this.end}else{diff=zoomMin-(newEnd-newStart);newStart-=diff/2;newEnd+=diff/2}}}if(this.options.zoomMax!==null){var zoomMax=parseFloat(this.options.zoomMax);if(zoomMax<0){zoomMax=0}if(newEnd-newStart>zoomMax){if(this.end-this.start===zoomMax&&newStart<this.start&&newEnd>this.end){newStart=this.start;newEnd=this.end}else{diff=newEnd-newStart-zoomMax;newStart+=diff/2;newEnd-=diff/2}}}var changed=this.start!=newStart||this.end!=newEnd;if(!(newStart>=this.start&&newStart<=this.end||newEnd>=this.start&&newEnd<=this.end)&&!(this.start>=newStart&&this.start<=newEnd||this.end>=newStart&&this.end<=newEnd)){this.body.emitter.emit("checkRangedItems")}this.start=newStart;this.end=newEnd;return changed};Range.prototype.getRange=function(){return{start:this.start,end:this.end}};Range.prototype.conversion=function(width,totalHidden){return Range.conversion(this.start,this.end,width,totalHidden)};Range.conversion=function(start,end,width,totalHidden){if(totalHidden===undefined){totalHidden=0}if(width!=0&&end-start!=0){return{offset:start,scale:width/(end-start-totalHidden)}}else{return{offset:0,scale:1}}};Range.prototype._onDragStart=function(event){this.deltaDifference=0;this.previousDelta=0;if(!this.options.moveable)return;if(!this.props.touch.allowDragging)return;this.props.touch.start=this.start;this.props.touch.end=this.end;this.props.touch.dragging=true;if(this.body.dom.root){this.body.dom.root.style.cursor="move"}};Range.prototype._onDrag=function(event){if(!this.options.moveable)return;if(!this.props.touch.allowDragging)return;var direction=this.options.direction;validateDirection(direction);var delta=direction=="horizontal"?event.gesture.deltaX:event.gesture.deltaY;delta-=this.deltaDifference;var interval=this.props.touch.end-this.props.touch.start;var duration=DateUtil.getHiddenDurationBetween(this.body.hiddenDates,this.start,this.end);interval-=duration;var width=direction=="horizontal"?this.body.domProps.center.width:this.body.domProps.center.height;var diffRange=-delta/width*interval;var newStart=this.props.touch.start+diffRange;var newEnd=this.props.touch.end+diffRange;var safeStart=DateUtil.snapAwayFromHidden(this.body.hiddenDates,newStart,this.previousDelta-delta,true);var safeEnd=DateUtil.snapAwayFromHidden(this.body.hiddenDates,newEnd,this.previousDelta-delta,true);if(safeStart!=newStart||safeEnd!=newEnd){this.deltaDifference+=delta;this.props.touch.start=safeStart;this.props.touch.end=safeEnd;this._onDrag(event);return}this.previousDelta=delta;this._applyRange(newStart,newEnd);this.body.emitter.emit("rangechange",{start:new Date(this.start),end:new Date(this.end),byUser:true})};Range.prototype._onDragEnd=function(event){if(!this.options.moveable)return;if(!this.props.touch.allowDragging)return;this.props.touch.dragging=false;if(this.body.dom.root){this.body.dom.root.style.cursor="auto"}this.body.emitter.emit("rangechanged",{start:new Date(this.start),end:new Date(this.end),byUser:true})};Range.prototype._onMouseWheel=function(event){if(!(this.options.zoomable&&this.options.moveable))return;var delta=0;if(event.wheelDelta){delta=event.wheelDelta/120}else if(event.detail){delta=-event.detail/3}if(delta){var scale;if(delta<0){scale=1-delta/5}else{scale=1/(1+delta/5)}var gesture=hammerUtil.fakeGesture(this,event),pointer=getPointer(gesture.center,this.body.dom.center),pointerDate=this._pointerToDate(pointer);this.zoom(scale,pointerDate,delta)}event.preventDefault()};Range.prototype._onTouch=function(event){this.props.touch.start=this.start;this.props.touch.end=this.end;this.props.touch.allowDragging=true;this.props.touch.center=null;this.scaleOffset=0;this.deltaDifference=0};Range.prototype._onHold=function(){this.props.touch.allowDragging=false};Range.prototype._onPinch=function(event){if(!(this.options.zoomable&&this.options.moveable))return;this.props.touch.allowDragging=false;if(event.gesture.touches.length>1){if(!this.props.touch.center){this.props.touch.center=getPointer(event.gesture.center,this.body.dom.center)}var scale=1/(event.gesture.scale+this.scaleOffset);var centerDate=this._pointerToDate(this.props.touch.center);var hiddenDuration=DateUtil.getHiddenDurationBetween(this.body.hiddenDates,this.start,this.end);var hiddenDurationBefore=DateUtil.getHiddenDurationBefore(this.body.hiddenDates,this,centerDate);var hiddenDurationAfter=hiddenDuration-hiddenDurationBefore;var newStart=centerDate-hiddenDurationBefore+(this.props.touch.start-(centerDate-hiddenDurationBefore))*scale;var newEnd=centerDate+hiddenDurationAfter+(this.props.touch.end-(centerDate+hiddenDurationAfter))*scale;this.startToFront=1-scale>0?false:true;this.endToFront=scale-1>0?false:true;var safeStart=DateUtil.snapAwayFromHidden(this.body.hiddenDates,newStart,1-scale,true);var safeEnd=DateUtil.snapAwayFromHidden(this.body.hiddenDates,newEnd,scale-1,true);if(safeStart!=newStart||safeEnd!=newEnd){this.props.touch.start=safeStart;this.props.touch.end=safeEnd;this.scaleOffset=1-event.gesture.scale;newStart=safeStart;newEnd=safeEnd}this.setRange(newStart,newEnd,false,true);this.startToFront=false;this.endToFront=true}};Range.prototype._pointerToDate=function(pointer){var conversion;var direction=this.options.direction;validateDirection(direction);if(direction=="horizontal"){return this.body.util.toTime(pointer.x).valueOf()}else{var height=this.body.domProps.center.height;conversion=this.conversion(height);return pointer.y/conversion.scale+conversion.offset}};function getPointer(touch,element){return{x:touch.pageX-util.getAbsoluteLeft(element),y:touch.pageY-util.getAbsoluteTop(element)}}Range.prototype.zoom=function(scale,center,delta){if(center==null){center=(this.start+this.end)/2}var hiddenDuration=DateUtil.getHiddenDurationBetween(this.body.hiddenDates,this.start,this.end);var hiddenDurationBefore=DateUtil.getHiddenDurationBefore(this.body.hiddenDates,this,center);var hiddenDurationAfter=hiddenDuration-hiddenDurationBefore;var newStart=center-hiddenDurationBefore+(this.start-(center-hiddenDurationBefore))*scale;var newEnd=center+hiddenDurationAfter+(this.end-(center+hiddenDurationAfter))*scale;this.startToFront=delta>0?false:true;this.endToFront=-delta>0?false:true;var safeStart=DateUtil.snapAwayFromHidden(this.body.hiddenDates,newStart,delta,true);var safeEnd=DateUtil.snapAwayFromHidden(this.body.hiddenDates,newEnd,-delta,true);if(safeStart!=newStart||safeEnd!=newEnd){newStart=safeStart;newEnd=safeEnd}this.setRange(newStart,newEnd,false,true);this.startToFront=false;this.endToFront=true};Range.prototype.move=function(delta){var diff=this.end-this.start;var newStart=this.start+diff*delta;var newEnd=this.end+diff*delta;this.start=newStart;this.end=newEnd};Range.prototype.moveTo=function(moveTo){var center=(this.start+this.end)/2;var diff=center-moveTo;var newStart=this.start-diff;var newEnd=this.end-diff;this.setRange(newStart,newEnd)};module.exports=Range},{"../hammerUtil":5,"../module/moment":7,"../util":28,"./DateUtil":10,"./component/Component":16}],12:[function(require,module,exports){var EPSILON=.001;exports.orderByStart=function(items){items.sort(function(a,b){return a.data.start-b.data.start})};exports.orderByEnd=function(items){items.sort(function(a,b){var aTime="end"in a.data?a.data.end:a.data.start,bTime="end"in b.data?b.data.end:b.data.start;return aTime-bTime})};exports.stack=function(items,margin,force){var i,iMax;if(force){for(i=0,iMax=items.length;i<iMax;i++){items[i].top=null}}for(i=0,iMax=items.length;i<iMax;i++){var item=items[i];if(item.stack&&item.top===null){item.top=margin.axis;do{var collidingItem=null;for(var j=0,jj=items.length;j<jj;j++){var other=items[j];if(other.top!==null&&other!==item&&other.stack&&exports.collision(item,other,margin.item)){collidingItem=other;break}}if(collidingItem!=null){item.top=collidingItem.top+collidingItem.height+margin.item.vertical}}while(collidingItem)}}};exports.nostack=function(items,margin,subgroups){var i,iMax,newTop;for(i=0,iMax=items.length;i<iMax;i++){if(items[i].data.subgroup!==undefined){newTop=margin.axis;for(var subgroup in subgroups){if(subgroups.hasOwnProperty(subgroup)){if(subgroups[subgroup].visible==true&&subgroups[subgroup].index<subgroups[items[i].data.subgroup].index){newTop+=subgroups[subgroup].height+margin.item.vertical}}}items[i].top=newTop}else{items[i].top=margin.axis}}};exports.collision=function(a,b,margin){return a.left-margin.horizontal+EPSILON<b.left+b.width&&a.left+a.width+margin.horizontal-EPSILON>b.left&&a.top-margin.vertical+EPSILON<b.top+b.height&&a.top+a.height+margin.vertical-EPSILON>b.top}},{}],13:[function(require,module,exports){var moment=require("../module/moment");var DateUtil=require("./DateUtil");var util=require("../util");function TimeStep(start,end,minimumStep,hiddenDates){this.current=new Date;this._start=new Date;this._end=new Date;this.autoScale=true;this.scale="day";this.step=1;this.setRange(start,end,minimumStep);this.switchedDay=false;this.switchedMonth=false;this.switchedYear=false;this.hiddenDates=hiddenDates;if(hiddenDates===undefined){this.hiddenDates=[]}this.format=TimeStep.FORMAT}TimeStep.FORMAT={minorLabels:{millisecond:"SSS",second:"s",minute:"HH:mm",hour:"HH:mm",weekday:"ddd D",day:"D",month:"MMM",year:"YYYY"},majorLabels:{millisecond:"HH:mm:ss",second:"D MMMM HH:mm",minute:"ddd D MMMM",hour:"ddd D MMMM",weekday:"MMMM YYYY",day:"MMMM YYYY",month:"YYYY",year:""}};TimeStep.prototype.setFormat=function(format){var defaultFormat=util.deepExtend({},TimeStep.FORMAT);this.format=util.deepExtend(defaultFormat,format)};TimeStep.prototype.setRange=function(start,end,minimumStep){if(!(start instanceof Date)||!(end instanceof Date)){throw"No legal start or end date in method setRange"}this._start=start!=undefined?new Date(start.valueOf()):new Date;this._end=end!=undefined?new Date(end.valueOf()):new Date;if(this.autoScale){this.setMinimumStep(minimumStep)}};TimeStep.prototype.first=function(){this.current=new Date(this._start.valueOf());this.roundToMinor()};TimeStep.prototype.roundToMinor=function(){switch(this.scale){case"year":this.current.setFullYear(this.step*Math.floor(this.current.getFullYear()/this.step));this.current.setMonth(0);case"month":this.current.setDate(1);case"day":case"weekday":this.current.setHours(0);case"hour":this.current.setMinutes(0);case"minute":this.current.setSeconds(0);case"second":this.current.setMilliseconds(0)}if(this.step!=1){switch(this.scale){case"millisecond":this.current.setMilliseconds(this.current.getMilliseconds()-this.current.getMilliseconds()%this.step);break;case"second":this.current.setSeconds(this.current.getSeconds()-this.current.getSeconds()%this.step);break;case"minute":this.current.setMinutes(this.current.getMinutes()-this.current.getMinutes()%this.step);break;case"hour":this.current.setHours(this.current.getHours()-this.current.getHours()%this.step);break;case"weekday":case"day":this.current.setDate(this.current.getDate()-1-(this.current.getDate()-1)%this.step+1);break;case"month":this.current.setMonth(this.current.getMonth()-this.current.getMonth()%this.step);break;case"year":this.current.setFullYear(this.current.getFullYear()-this.current.getFullYear()%this.step);break;default:break}}};TimeStep.prototype.hasNext=function(){return this.current.valueOf()<=this._end.valueOf()};TimeStep.prototype.next=function(){var prev=this.current.valueOf();if(this.current.getMonth()<6){switch(this.scale){case"millisecond":this.current=new Date(this.current.valueOf()+this.step);break;case"second":this.current=new Date(this.current.valueOf()+this.step*1e3);break;case"minute":this.current=new Date(this.current.valueOf()+this.step*1e3*60);break;case"hour":this.current=new Date(this.current.valueOf()+this.step*1e3*60*60);

var h=this.current.getHours();this.current.setHours(h-h%this.step);break;case"weekday":case"day":this.current.setDate(this.current.getDate()+this.step);break;case"month":this.current.setMonth(this.current.getMonth()+this.step);break;case"year":this.current.setFullYear(this.current.getFullYear()+this.step);break;default:break}}else{switch(this.scale){case"millisecond":this.current=new Date(this.current.valueOf()+this.step);break;case"second":this.current.setSeconds(this.current.getSeconds()+this.step);break;case"minute":this.current.setMinutes(this.current.getMinutes()+this.step);break;case"hour":this.current.setHours(this.current.getHours()+this.step);break;case"weekday":case"day":this.current.setDate(this.current.getDate()+this.step);break;case"month":this.current.setMonth(this.current.getMonth()+this.step);break;case"year":this.current.setFullYear(this.current.getFullYear()+this.step);break;default:break}}if(this.step!=1){switch(this.scale){case"millisecond":if(this.current.getMilliseconds()<this.step)this.current.setMilliseconds(0);break;case"second":if(this.current.getSeconds()<this.step)this.current.setSeconds(0);break;case"minute":if(this.current.getMinutes()<this.step)this.current.setMinutes(0);break;case"hour":if(this.current.getHours()<this.step)this.current.setHours(0);break;case"weekday":case"day":if(this.current.getDate()<this.step+1)this.current.setDate(1);break;case"month":if(this.current.getMonth()<this.step)this.current.setMonth(0);break;case"year":break;default:break}}if(this.current.valueOf()==prev){this.current=new Date(this._end.valueOf())}DateUtil.stepOverHiddenDates(this,prev)};TimeStep.prototype.getCurrent=function(){return this.current};TimeStep.prototype.setScale=function(params){if(params&&typeof params.scale=="string"){this.scale=params.scale;this.step=params.step>0?params.step:1;this.autoScale=false}};TimeStep.prototype.setAutoScale=function(enable){this.autoScale=enable};TimeStep.prototype.setMinimumStep=function(minimumStep){if(minimumStep==undefined){return}var stepYear=1e3*60*60*24*30*12;var stepMonth=1e3*60*60*24*30;var stepDay=1e3*60*60*24;var stepHour=1e3*60*60;var stepMinute=1e3*60;var stepSecond=1e3;var stepMillisecond=1;if(stepYear*1e3>minimumStep){this.scale="year";this.step=1e3}if(stepYear*500>minimumStep){this.scale="year";this.step=500}if(stepYear*100>minimumStep){this.scale="year";this.step=100}if(stepYear*50>minimumStep){this.scale="year";this.step=50}if(stepYear*10>minimumStep){this.scale="year";this.step=10}if(stepYear*5>minimumStep){this.scale="year";this.step=5}if(stepYear>minimumStep){this.scale="year";this.step=1}if(stepMonth*3>minimumStep){this.scale="month";this.step=3}if(stepMonth>minimumStep){this.scale="month";this.step=1}if(stepDay*5>minimumStep){this.scale="day";this.step=5}if(stepDay*2>minimumStep){this.scale="day";this.step=2}if(stepDay>minimumStep){this.scale="day";this.step=1}if(stepDay/2>minimumStep){this.scale="weekday";this.step=1}if(stepHour*4>minimumStep){this.scale="hour";this.step=4}if(stepHour>minimumStep){this.scale="hour";this.step=1}if(stepMinute*15>minimumStep){this.scale="minute";this.step=15}if(stepMinute*10>minimumStep){this.scale="minute";this.step=10}if(stepMinute*5>minimumStep){this.scale="minute";this.step=5}if(stepMinute>minimumStep){this.scale="minute";this.step=1}if(stepSecond*15>minimumStep){this.scale="second";this.step=15}if(stepSecond*10>minimumStep){this.scale="second";this.step=10}if(stepSecond*5>minimumStep){this.scale="second";this.step=5}if(stepSecond>minimumStep){this.scale="second";this.step=1}if(stepMillisecond*200>minimumStep){this.scale="millisecond";this.step=200}if(stepMillisecond*100>minimumStep){this.scale="millisecond";this.step=100}if(stepMillisecond*50>minimumStep){this.scale="millisecond";this.step=50}if(stepMillisecond*10>minimumStep){this.scale="millisecond";this.step=10}if(stepMillisecond*5>minimumStep){this.scale="millisecond";this.step=5}if(stepMillisecond>minimumStep){this.scale="millisecond";this.step=1}};TimeStep.snap=function(date,scale,step){var clone=new Date(date.valueOf());if(scale=="year"){var year=clone.getFullYear()+Math.round(clone.getMonth()/12);clone.setFullYear(Math.round(year/step)*step);clone.setMonth(0);clone.setDate(0);clone.setHours(0);clone.setMinutes(0);clone.setSeconds(0);clone.setMilliseconds(0)}else if(scale=="month"){if(clone.getDate()>15){clone.setDate(1);clone.setMonth(clone.getMonth()+1)}else{clone.setDate(1)}clone.setHours(0);clone.setMinutes(0);clone.setSeconds(0);clone.setMilliseconds(0)}else if(scale=="day"){switch(step){case 5:case 2:clone.setHours(Math.round(clone.getHours()/24)*24);break;default:clone.setHours(Math.round(clone.getHours()/12)*12);break}clone.setMinutes(0);clone.setSeconds(0);clone.setMilliseconds(0)}else if(scale=="weekday"){switch(step){case 5:case 2:clone.setHours(Math.round(clone.getHours()/12)*12);break;default:clone.setHours(Math.round(clone.getHours()/6)*6);break}clone.setMinutes(0);clone.setSeconds(0);clone.setMilliseconds(0)}else if(scale=="hour"){switch(step){case 4:clone.setMinutes(Math.round(clone.getMinutes()/60)*60);break;default:clone.setMinutes(Math.round(clone.getMinutes()/30)*30);break}clone.setSeconds(0);clone.setMilliseconds(0)}else if(scale=="minute"){switch(step){case 15:case 10:clone.setMinutes(Math.round(clone.getMinutes()/5)*5);clone.setSeconds(0);break;case 5:clone.setSeconds(Math.round(clone.getSeconds()/60)*60);break;default:clone.setSeconds(Math.round(clone.getSeconds()/30)*30);break}clone.setMilliseconds(0)}else if(scale=="second"){switch(step){case 15:case 10:clone.setSeconds(Math.round(clone.getSeconds()/5)*5);clone.setMilliseconds(0);break;case 5:clone.setMilliseconds(Math.round(clone.getMilliseconds()/1e3)*1e3);break;default:clone.setMilliseconds(Math.round(clone.getMilliseconds()/500)*500);break}}else if(scale=="millisecond"){var _step=step>5?step/2:1;clone.setMilliseconds(Math.round(clone.getMilliseconds()/_step)*_step)}return clone};TimeStep.prototype.isMajor=function(){if(this.switchedYear==true){this.switchedYear=false;switch(this.scale){case"year":case"month":case"weekday":case"day":case"hour":case"minute":case"second":case"millisecond":return true;default:return false}}else if(this.switchedMonth==true){this.switchedMonth=false;switch(this.scale){case"weekday":case"day":case"hour":case"minute":case"second":case"millisecond":return true;default:return false}}else if(this.switchedDay==true){this.switchedDay=false;switch(this.scale){case"millisecond":case"second":case"minute":case"hour":return true;default:return false}}switch(this.scale){case"millisecond":return this.current.getMilliseconds()==0;case"second":return this.current.getSeconds()==0;case"minute":return this.current.getHours()==0&&this.current.getMinutes()==0;case"hour":return this.current.getHours()==0;case"weekday":case"day":return this.current.getDate()==1;case"month":return this.current.getMonth()==0;case"year":return false;default:return false}};TimeStep.prototype.getLabelMinor=function(date){if(date==undefined){date=this.current}var format=this.format.minorLabels[this.scale];return format&&format.length>0?moment(date).format(format):""};TimeStep.prototype.getLabelMajor=function(date){if(date==undefined){date=this.current}var format=this.format.majorLabels[this.scale];return format&&format.length>0?moment(date).format(format):""};TimeStep.prototype.getClassName=function(){var m=moment(this.current);var date=m.locale?m.locale("en"):m.lang("en");var step=this.step;function even(value){return value/step%2==0?" even":" odd"}function today(date){if(date.isSame(new Date,"day")){return" today"}if(date.isSame(moment().add(1,"day"),"day")){return" tomorrow"}if(date.isSame(moment().add(-1,"day"),"day")){return" yesterday"}return""}function currentWeek(date){return date.isSame(new Date,"week")?" current-week":""}function currentMonth(date){return date.isSame(new Date,"month")?" current-month":""}function currentYear(date){return date.isSame(new Date,"year")?" current-year":""}switch(this.scale){case"millisecond":return even(date.milliseconds()).trim();case"second":return even(date.seconds()).trim();case"minute":return even(date.minutes()).trim();case"hour":var hours=date.hours();if(this.step==4){hours=hours+"-"+(hours+4)}return hours+"h"+today(date)+even(date.hours());case"weekday":return date.format("dddd").toLowerCase()+today(date)+currentWeek(date)+even(date.date());case"day":var day=date.date();var month=date.format("MMMM").toLowerCase();return"day"+day+" "+month+currentMonth(date)+even(day-1);case"month":return date.format("MMMM").toLowerCase()+currentMonth(date)+even(date.month());case"year":var year=date.year();return"year"+year+currentYear(date)+even(year);default:return""}};module.exports=TimeStep},{"../module/moment":7,"../util":28,"./DateUtil":10}],14:[function(require,module,exports){var Emitter=require("emitter-component");var Hammer=require("../module/hammer");var util=require("../util");var DataSet=require("../DataSet");var DataView=require("../DataView");var Range=require("./Range");var Core=require("./Core");var TimeAxis=require("./component/TimeAxis");var CurrentTime=require("./component/CurrentTime");var CustomTime=require("./component/CustomTime");var ItemSet=require("./component/ItemSet");function Timeline(container,items,groups,options){if(!(this instanceof Timeline)){throw new SyntaxError("Constructor must be called with the new operator")}if(!(Array.isArray(groups)||groups instanceof DataSet||groups instanceof DataView)&&groups instanceof Object){var forthArgument=options;options=groups;groups=forthArgument}var me=this;this.defaultOptions={start:null,end:null,autoResize:true,orientation:"bottom",width:null,height:null,maxHeight:null,minHeight:null};this.options=util.deepExtend({},this.defaultOptions);this._create(container);this.components=[];this.body={dom:this.dom,domProps:this.props,emitter:{on:this.on.bind(this),off:this.off.bind(this),emit:this.emit.bind(this)},hiddenDates:[],util:{getScale:function(){return me.timeAxis.step.scale},getStep:function(){return me.timeAxis.step.step},toScreen:me._toScreen.bind(me),toGlobalScreen:me._toGlobalScreen.bind(me),toTime:me._toTime.bind(me),toGlobalTime:me._toGlobalTime.bind(me)}};this.range=new Range(this.body);this.components.push(this.range);this.body.range=this.range;this.timeAxis=new TimeAxis(this.body);this.timeAxis2=null;this.components.push(this.timeAxis);this.currentTime=new CurrentTime(this.body);this.components.push(this.currentTime);this.itemSet=new ItemSet(this.body);this.components.push(this.itemSet);this.itemsData=null;this.groupsData=null;this.on("tap",function(event){me.emit("click",me.getEventProperties(event))});this.on("doubletap",function(event){me.emit("doubleClick",me.getEventProperties(event))});this.dom.root.oncontextmenu=function(event){me.emit("contextmenu",me.getEventProperties(event))};if(options){this.setOptions(options)}if(groups){this.setGroups(groups)}if(items){this.setItems(items)}else{this._redraw()}}Timeline.prototype=new Core;Timeline.prototype.redraw=function(){this.itemSet&&this.itemSet.markDirty({refreshItems:true});this._redraw()};Timeline.prototype.setItems=function(items){var initialLoad=this.itemsData==null;var newDataSet;if(!items){newDataSet=null}else if(items instanceof DataSet||items instanceof DataView){newDataSet=items}else{newDataSet=new DataSet(items,{type:{start:"Date",end:"Date"}})}this.itemsData=newDataSet;this.itemSet&&this.itemSet.setItems(newDataSet);if(initialLoad){if(this.options.start!=undefined||this.options.end!=undefined){if(this.options.start==undefined||this.options.end==undefined){var dataRange=this._getDataRange()}var start=this.options.start!=undefined?this.options.start:dataRange.start;var end=this.options.end!=undefined?this.options.end:dataRange.end;this.setWindow(start,end,{animate:false})}else{this.fit({animate:false})}}};Timeline.prototype.setGroups=function(groups){var newDataSet;if(!groups){newDataSet=null}else if(groups instanceof DataSet||groups instanceof DataView){newDataSet=groups}else{newDataSet=new DataSet(groups)}this.groupsData=newDataSet;this.itemSet.setGroups(newDataSet)};Timeline.prototype.setSelection=function(ids,options){this.itemSet&&this.itemSet.setSelection(ids);if(options&&options.focus){this.focus(ids,options)}};Timeline.prototype.getSelection=function(){return this.itemSet&&this.itemSet.getSelection()||[]};Timeline.prototype.focus=function(id,options){if(!this.itemsData||id==undefined)return;var ids=Array.isArray(id)?id:[id];var itemsData=this.itemsData.getDataSet().get(ids,{type:{start:"Date",end:"Date"}});var start=null;var end=null;itemsData.forEach(function(itemData){var s=itemData.start.valueOf();var e="end"in itemData?itemData.end.valueOf():itemData.start.valueOf();if(start===null||s<start){start=s}if(end===null||e>end){end=e}});if(start!==null&&end!==null){var middle=(start+end)/2;var interval=Math.max(this.range.end-this.range.start,(end-start)*1.1);var animate=options&&options.animate!==undefined?options.animate:true;this.range.setRange(middle-interval/2,middle+interval/2,animate)}};Timeline.prototype.getItemRange=function(){var dataset=this.itemsData.getDataSet(),min=null,max=null;if(dataset){var minItem=dataset.min("start");min=minItem?util.convert(minItem.start,"Date").valueOf():null;var maxStartItem=dataset.max("start");if(maxStartItem){max=util.convert(maxStartItem.start,"Date").valueOf()}var maxEndItem=dataset.max("end");if(maxEndItem){if(max==null){max=util.convert(maxEndItem.end,"Date").valueOf()}else{max=Math.max(max,util.convert(maxEndItem.end,"Date").valueOf())}}}return{min:min!=null?new Date(min):null,max:max!=null?new Date(max):null}};Timeline.prototype.getEventProperties=function(event){var item=this.itemSet.itemFromTarget(event);var group=this.itemSet.groupFromTarget(event);var pageX=event.gesture?event.gesture.center.pageX:event.pageX;var pageY=event.gesture?event.gesture.center.pageY:event.pageY;var x=pageX-util.getAbsoluteLeft(this.dom.centerContainer);var y=pageY-util.getAbsoluteTop(this.dom.centerContainer);var snap=this.itemSet.options.snap||null;var scale=this.body.util.getScale();var step=this.body.util.getStep();var time=this._toTime(x);var snappedTime=snap?snap(time,scale,step):time;var element=util.getTarget(event);var what=null;if(item!=null){what="item"}else if(util.hasParent(element,this.timeAxis.dom.foreground)){what="axis"}else if(this.timeAxis2&&util.hasParent(element,this.timeAxis2.dom.foreground)){what="axis"}else if(util.hasParent(element,this.itemSet.dom.labelSet)){what="group-label"}else if(util.hasParent(element,this.currentTime.bar)){what="current-time"}else if(util.hasParent(element,this.dom.center)){what="background"}return{event:event,item:item?item.id:null,group:group?group.groupId:null,what:what,pageX:pageX,pageY:pageY,x:x,y:y,time:time,snappedTime:snappedTime}};module.exports=Timeline},{"../DataSet":2,"../DataView":3,"../module/hammer":6,"../util":28,"./Core":9,"./Range":11,"./component/CurrentTime":17,"./component/CustomTime":18,"./component/ItemSet":20,"./component/TimeAxis":21,"emitter-component":29}],15:[function(require,module,exports){var util=require("../../util");var Group=require("./Group");function BackgroundGroup(groupId,data,itemSet){Group.call(this,groupId,data,itemSet);this.width=0;this.height=0;this.top=0;this.left=0}BackgroundGroup.prototype=Object.create(Group.prototype);BackgroundGroup.prototype.redraw=function(range,margin,restack){var resized=false;this.visibleItems=this._updateVisibleItems(this.orderedItems,this.visibleItems,range);this.width=this.dom.background.offsetWidth;this.dom.background.style.height="0";for(var i=0,ii=this.visibleItems.length;i<ii;i++){var item=this.visibleItems[i];item.repositionY(margin)}return resized};BackgroundGroup.prototype.show=function(){if(!this.dom.background.parentNode){this.itemSet.dom.background.appendChild(this.dom.background)}};module.exports=BackgroundGroup},{"../../util":28,"./Group":19}],16:[function(require,module,exports){function Component(body,options){this.options=null;this.props=null}Component.prototype.setOptions=function(options){if(options){util.extend(this.options,options)}};Component.prototype.redraw=function(){return false};Component.prototype.destroy=function(){};Component.prototype._isResized=function(){var resized=this.props._previousWidth!==this.props.width||this.props._previousHeight!==this.props.height;this.props._previousWidth=this.props.width;this.props._previousHeight=this.props.height;return resized};module.exports=Component},{}],17:[function(require,module,exports){var util=require("../../util");var Component=require("./Component");var moment=require("../../module/moment");var locales=require("../locales");function CurrentTime(body,options){this.body=body;this.defaultOptions={showCurrentTime:true,locales:locales,locale:"en"};this.options=util.extend({},this.defaultOptions);this.offset=0;this._create();this.setOptions(options)}CurrentTime.prototype=new Component;CurrentTime.prototype._create=function(){var bar=document.createElement("div");bar.className="currenttime";bar.style.position="absolute";bar.style.top="0px";bar.style.height="100%";this.bar=bar};CurrentTime.prototype.destroy=function(){this.options.showCurrentTime=false;this.redraw();this.body=null};CurrentTime.prototype.setOptions=function(options){if(options){util.selectiveExtend(["showCurrentTime","locale","locales"],this.options,options)}};CurrentTime.prototype.redraw=function(){if(this.options.showCurrentTime){var parent=this.body.dom.backgroundVertical;if(this.bar.parentNode!=parent){if(this.bar.parentNode){this.bar.parentNode.removeChild(this.bar)}parent.appendChild(this.bar);this.start()}var now=new Date((new Date).valueOf()+this.offset);var x=this.body.util.toScreen(now);var locale=this.options.locales[this.options.locale];var title=locale.current+" "+locale.time+": "+moment(now).format("dddd, MMMM Do YYYY, H:mm:ss");title=title.charAt(0).toUpperCase()+title.substring(1);this.bar.style.left=x+"px";this.bar.title=title}else{if(this.bar.parentNode){this.bar.parentNode.removeChild(this.bar)}this.stop()}return false};CurrentTime.prototype.start=function(){var me=this;function update(){me.stop();var scale=me.body.range.conversion(me.body.domProps.center.width).scale;var interval=1/scale/10;if(interval<30)interval=30;if(interval>1e3)interval=1e3;me.redraw();me.currentTimeTimer=setTimeout(update,interval)}update()};CurrentTime.prototype.stop=function(){if(this.currentTimeTimer!==undefined){clearTimeout(this.currentTimeTimer);delete this.currentTimeTimer}};CurrentTime.prototype.setCurrentTime=function(time){var t=util.convert(time,"Date").valueOf();var now=(new Date).valueOf();this.offset=t-now;this.redraw()};CurrentTime.prototype.getCurrentTime=function(){return new Date((new Date).valueOf()+this.offset)};module.exports=CurrentTime},{"../../module/moment":7,"../../util":28,"../locales":27,"./Component":16}],18:[function(require,module,exports){var Hammer=require("../../module/hammer");var util=require("../../util");var Component=require("./Component");var moment=require("../../module/moment");var locales=require("../locales");var TimeStep=require("../TimeStep");function CustomTime(body,options){this.body=body;this.defaultOptions={showCustomTime:false,locales:locales,locale:"en",id:0,cssClass:"",snap:TimeStep.snap};this.options=util.extend({},this.defaultOptions);if(options&&options.time){this.customTime=options.time}else{this.customTime=new Date}this.eventParams={};this._create();this.setOptions(options)}CustomTime.prototype=new Component;CustomTime.prototype.setOptions=function(options){if(options){util.selectiveExtend(["showCustomTime","locale","locales","id","cssClass","snap"],this.options,options);if(this.options.cssClass!=null){this.bar.className+=" "+this.options.cssClass}if(this.options.id){this.redraw()}}};CustomTime.prototype._create=function(){var bar=document.createElement("div");bar.className="customtime";bar.style.position="absolute";bar.style.top="0px";bar.style.height="100%";this.bar=bar;var drag=document.createElement("div");drag.style.position="relative";drag.style.top="0px";drag.style.left="-10px";drag.style.height="100%";drag.style.width="20px";bar.appendChild(drag);this.hammer=Hammer(bar,{prevent_default:true});this.hammer.on("dragstart",this._onDragStart.bind(this));this.hammer.on("drag",this._onDrag.bind(this));this.hammer.on("dragend",this._onDragEnd.bind(this))};CustomTime.prototype.destroy=function(){this.options.showCustomTime=false;this.redraw();this.hammer.enable(false);this.hammer=null;this.body=null};CustomTime.prototype.redraw=function(){if(this.options.showCustomTime){var parent=this.body.dom.backgroundVertical;if(this.bar.parentNode!=parent){if(this.bar.parentNode){this.bar.parentNode.removeChild(this.bar)}parent.appendChild(this.bar)}var x=this.body.util.toScreen(this.customTime);var locale=this.options.locales[this.options.locale];var title=locale.time+": "+moment(this.customTime).format("dddd, MMMM Do YYYY, H:mm:ss");title=title.charAt(0).toUpperCase()+title.substring(1);this.bar.style.left=x+"px";this.bar.title=title}else{if(this.bar.parentNode){this.bar.parentNode.removeChild(this.bar)}}return false};CustomTime.prototype.setCustomTime=function(time){this.customTime=util.convert(time,"Date");this.redraw()};CustomTime.prototype.getCustomTime=function(){return new Date(this.customTime.valueOf())};CustomTime.prototype._onDragStart=function(event){this.eventParams.dragging=true;this.eventParams.customTime=this.customTime;event.stopPropagation();event.preventDefault()};CustomTime.prototype._onDrag=function(event){if(!this.eventParams.dragging)return;var scale=this.body.util.getScale();var step=this.body.util.getStep();var snap=this.options.snap||null;var deltaX=event.gesture.deltaX,x=this.body.util.toScreen(this.eventParams.customTime)+deltaX,time=this.body.util.toTime(x);this.setCustomTime(snap?snap(time,scale,step):time);this.body.emitter.emit("timechange",{id:this.options.id,time:new Date(this.customTime.valueOf())});event.stopPropagation();event.preventDefault()};CustomTime.prototype._onDragEnd=function(event){if(!this.eventParams.dragging)return;this.body.emitter.emit("timechanged",{id:this.options.id,time:new Date(this.customTime.valueOf())});event.stopPropagation();event.preventDefault()};module.exports=CustomTime},{"../../module/hammer":6,"../../module/moment":7,"../../util":28,"../TimeStep":13,"../locales":27,"./Component":16}],19:[function(require,module,exports){var util=require("../../util");var stack=require("../Stack");var RangeItem=require("./item/RangeItem");function Group(groupId,data,itemSet){this.groupId=groupId;this.subgroups={};this.subgroupIndex=0;this.subgroupOrderer=data&&data.subgroupOrder;this.itemSet=itemSet;this.dom={};this.props={label:{width:0,height:0}};this.className=null;this.items={};this.visibleItems=[];this.orderedItems={byStart:[],byEnd:[]};this.checkRangedItems=false;var me=this;this.itemSet.body.emitter.on("checkRangedItems",function(){me.checkRangedItems=true});this._create();this.setData(data)}Group.prototype._create=function(){var label=document.createElement("div");label.className="vlabel";this.dom.label=label;var inner=document.createElement("div");inner.className="inner";label.appendChild(inner);this.dom.inner=inner;var foreground=document.createElement("div");foreground.className="group";foreground["timeline-group"]=this;this.dom.foreground=foreground;this.dom.background=document.createElement("div");this.dom.background.className="group";this.dom.axis=document.createElement("div");this.dom.axis.className="group";this.dom.marker=document.createElement("div");this.dom.marker.style.visibility="hidden";this.dom.marker.innerHTML="?";this.dom.background.appendChild(this.dom.marker)};Group.prototype.setData=function(data){var content=data&&data.content;if(content instanceof Element){this.dom.inner.appendChild(content)}else if(content!==undefined&&content!==null){this.dom.inner.innerHTML=content}else{this.dom.inner.innerHTML=this.groupId||""}this.dom.label.title=data&&data.title||"";if(!this.dom.inner.firstChild){util.addClassName(this.dom.inner,"hidden")}else{util.removeClassName(this.dom.inner,"hidden")}var className=data&&data.className||null;if(className!=this.className){if(this.className){util.removeClassName(this.dom.label,this.className);util.removeClassName(this.dom.foreground,this.className);util.removeClassName(this.dom.background,this.className);util.removeClassName(this.dom.axis,this.className)}util.addClassName(this.dom.label,className);util.addClassName(this.dom.foreground,className);util.addClassName(this.dom.background,className);util.addClassName(this.dom.axis,className);this.className=className}if(this.style){util.removeCssText(this.dom.label,this.style);this.style=null}if(data&&data.style){util.addCssText(this.dom.label,data.style);this.style=data.style}};Group.prototype.getLabelWidth=function(){return this.props.label.width};Group.prototype.redraw=function(range,margin,restack){var resized=false;var markerHeight=this.dom.marker.clientHeight;if(markerHeight!=this.lastMarkerHeight){this.lastMarkerHeight=markerHeight;util.forEach(this.items,function(item){item.dirty=true;if(item.displayed)item.redraw()});restack=true}if(typeof this.itemSet.options.order==="function"){if(restack){var me=this;var limitSize=false;util.forEach(this.items,function(item){if(!item.displayed){item.redraw();me.visibleItems.push(item)}item.repositionX(limitSize)});var customOrderedItems=this.orderedItems.byStart.slice().sort(function(a,b){return me.itemSet.options.order(a.data,b.data)});stack.stack(customOrderedItems,margin,true)}this.visibleItems=this._updateVisibleItems(this.orderedItems,this.visibleItems,range)}else{this.visibleItems=this._updateVisibleItems(this.orderedItems,this.visibleItems,range);if(this.itemSet.options.stack){stack.stack(this.visibleItems,margin,restack)}else{stack.nostack(this.visibleItems,margin,this.subgroups)}}var height=this._calculateHeight(margin);var foreground=this.dom.foreground;this.top=foreground.offsetTop;this.left=foreground.offsetLeft;this.width=foreground.offsetWidth;resized=util.updateProperty(this,"height",height)||resized;resized=util.updateProperty(this.props.label,"width",this.dom.inner.clientWidth)||resized;resized=util.updateProperty(this.props.label,"height",this.dom.inner.clientHeight)||resized;this.dom.background.style.height=height+"px";this.dom.foreground.style.height=height+"px";this.dom.label.style.height=height+"px";for(var i=0,ii=this.visibleItems.length;i<ii;i++){var item=this.visibleItems[i];item.repositionY(margin)}return resized};Group.prototype._calculateHeight=function(margin){var height;var visibleItems=this.visibleItems;this.resetSubgroups();var me=this;if(visibleItems.length){var min=visibleItems[0].top;var max=visibleItems[0].top+visibleItems[0].height;util.forEach(visibleItems,function(item){min=Math.min(min,item.top);max=Math.max(max,item.top+item.height);if(item.data.subgroup!==undefined){me.subgroups[item.data.subgroup].height=Math.max(me.subgroups[item.data.subgroup].height,item.height);me.subgroups[item.data.subgroup].visible=true}});if(min>margin.axis){var offset=min-margin.axis;max-=offset;util.forEach(visibleItems,function(item){item.top-=offset})}height=max+margin.item.vertical/2}else{height=0}height=Math.max(height,this.props.label.height);return height};Group.prototype.show=function(){if(!this.dom.label.parentNode){this.itemSet.dom.labelSet.appendChild(this.dom.label)}if(!this.dom.foreground.parentNode){this.itemSet.dom.foreground.appendChild(this.dom.foreground)}if(!this.dom.background.parentNode){this.itemSet.dom.background.appendChild(this.dom.background)}if(!this.dom.axis.parentNode){this.itemSet.dom.axis.appendChild(this.dom.axis)}};Group.prototype.hide=function(){var label=this.dom.label;if(label.parentNode){label.parentNode.removeChild(label)}var foreground=this.dom.foreground;if(foreground.parentNode){foreground.parentNode.removeChild(foreground)}var background=this.dom.background;if(background.parentNode){background.parentNode.removeChild(background)}var axis=this.dom.axis;if(axis.parentNode){axis.parentNode.removeChild(axis)}};Group.prototype.add=function(item){this.items[item.id]=item;item.setParent(this);if(item.data.subgroup!==undefined){if(this.subgroups[item.data.subgroup]===undefined){this.subgroups[item.data.subgroup]={height:0,visible:false,index:this.subgroupIndex,items:[]};this.subgroupIndex++}this.subgroups[item.data.subgroup].items.push(item)}this.orderSubgroups();if(this.visibleItems.indexOf(item)==-1){var range=this.itemSet.body.range;this._checkIfVisible(item,this.visibleItems,range)}};Group.prototype.orderSubgroups=function(){if(this.subgroupOrderer!==undefined){var sortArray=[];if(typeof this.subgroupOrderer=="string"){for(var subgroup in this.subgroups){sortArray.push({subgroup:subgroup,sortField:this.subgroups[subgroup].items[0].data[this.subgroupOrderer]})}sortArray.sort(function(a,b){return a.sortField-b.sortField})}else if(typeof this.subgroupOrderer=="function"){for(var subgroup in this.subgroups){sortArray.push(this.subgroups[subgroup].items[0].data)}sortArray.sort(this.subgroupOrderer)}if(sortArray.length>0){for(var i=0;i<sortArray.length;i++){this.subgroups[sortArray[i].subgroup].index=i}}}};Group.prototype.resetSubgroups=function(){for(var subgroup in this.subgroups){if(this.subgroups.hasOwnProperty(subgroup)){this.subgroups[subgroup].visible=false}}};Group.prototype.remove=function(item){delete this.items[item.id];item.setParent(null);var index=this.visibleItems.indexOf(item);if(index!=-1)this.visibleItems.splice(index,1)};Group.prototype.removeFromDataSet=function(item){this.itemSet.removeItem(item.id)};Group.prototype.order=function(){var array=util.toArray(this.items);var startArray=[];var endArray=[];for(var i=0;i<array.length;i++){if(array[i].data.end!==undefined){endArray.push(array[i])}startArray.push(array[i])}this.orderedItems={byStart:startArray,byEnd:endArray};stack.orderByStart(this.orderedItems.byStart);stack.orderByEnd(this.orderedItems.byEnd)};Group.prototype._updateVisibleItems=function(orderedItems,oldVisibleItems,range){var visibleItems=[];var visibleItemsLookup={};var interval=(range.end-range.start)/4;var lowerBound=range.start-interval;var upperBound=range.end+interval;var item,i;var searchFunction=function(value){if(value<lowerBound){return-1}else if(value<=upperBound){return 0}else{return 1}};if(oldVisibleItems.length>0){for(i=0;i<oldVisibleItems.length;i++){this._checkIfVisibleWithReference(oldVisibleItems[i],visibleItems,visibleItemsLookup,range)}}var initialPosByStart=util.binarySearchCustom(orderedItems.byStart,searchFunction,"data","start");this._traceVisible(initialPosByStart,orderedItems.byStart,visibleItems,visibleItemsLookup,function(item){return item.data.start<lowerBound||item.data.start>upperBound});if(this.checkRangedItems==true){this.checkRangedItems=false;for(i=0;i<orderedItems.byEnd.length;i++){this._checkIfVisibleWithReference(orderedItems.byEnd[i],visibleItems,visibleItemsLookup,range)}}else{var initialPosByEnd=util.binarySearchCustom(orderedItems.byEnd,searchFunction,"data","end");this._traceVisible(initialPosByEnd,orderedItems.byEnd,visibleItems,visibleItemsLookup,function(item){return item.data.end<lowerBound||item.data.end>upperBound})}for(i=0;i<visibleItems.length;i++){item=visibleItems[i];if(!item.displayed)item.show();item.repositionX()}return visibleItems};Group.prototype._traceVisible=function(initialPos,items,visibleItems,visibleItemsLookup,breakCondition){var item;var i;if(initialPos!=-1){for(i=initialPos;i>=0;i--){item=items[i];if(breakCondition(item)){break}else{if(visibleItemsLookup[item.id]===undefined){visibleItemsLookup[item.id]=true;visibleItems.push(item)}}}for(i=initialPos+1;i<items.length;i++){item=items[i];if(breakCondition(item)){break}else{if(visibleItemsLookup[item.id]===undefined){visibleItemsLookup[item.id]=true;visibleItems.push(item)}}}}};Group.prototype._checkIfVisible=function(item,visibleItems,range){if(item.isVisible(range)){
if(!item.displayed)item.show();item.repositionX();visibleItems.push(item)}else{if(item.displayed)item.hide()}};Group.prototype._checkIfVisibleWithReference=function(item,visibleItems,visibleItemsLookup,range){if(item.isVisible(range)){if(visibleItemsLookup[item.id]===undefined){visibleItemsLookup[item.id]=true;visibleItems.push(item)}}else{if(item.displayed)item.hide()}};module.exports=Group},{"../../util":28,"../Stack":12,"./item/RangeItem":26}],20:[function(require,module,exports){var Hammer=require("../../module/hammer");var util=require("../../util");var DataSet=require("../../DataSet");var DataView=require("../../DataView");var TimeStep=require("../TimeStep");var Component=require("./Component");var Group=require("./Group");var BackgroundGroup=require("./BackgroundGroup");var BoxItem=require("./item/BoxItem");var PointItem=require("./item/PointItem");var RangeItem=require("./item/RangeItem");var BackgroundItem=require("./item/BackgroundItem");var UNGROUPED="__ungrouped__";var BACKGROUND="__background__";function ItemSet(body,options){this.body=body;this.defaultOptions={type:null,orientation:"bottom",align:"auto",stack:true,groupOrder:null,selectable:true,editable:{updateTime:false,updateGroup:false,add:false,remove:false},snap:TimeStep.snap,onAdd:function(item,callback){callback(item)},onUpdate:function(item,callback){callback(item)},onMove:function(item,callback){callback(item)},onRemove:function(item,callback){callback(item)},onMoving:function(item,callback){callback(item)},margin:{item:{horizontal:10,vertical:10},axis:20},padding:5};this.options=util.extend({},this.defaultOptions);this.itemOptions={type:{start:"Date",end:"Date"}};this.conversion={toScreen:body.util.toScreen,toTime:body.util.toTime};this.dom={};this.props={};this.hammer=null;var me=this;this.itemsData=null;this.groupsData=null;this.itemListeners={add:function(event,params,senderId){me._onAdd(params.items)},update:function(event,params,senderId){me._onUpdate(params.items)},remove:function(event,params,senderId){me._onRemove(params.items)}};this.groupListeners={add:function(event,params,senderId){me._onAddGroups(params.items)},update:function(event,params,senderId){me._onUpdateGroups(params.items)},remove:function(event,params,senderId){me._onRemoveGroups(params.items)}};this.items={};this.groups={};this.groupIds=[];this.selection=[];this.stackDirty=true;this.touchParams={};this._create();this.setOptions(options)}ItemSet.prototype=new Component;ItemSet.types={background:BackgroundItem,box:BoxItem,range:RangeItem,point:PointItem};ItemSet.prototype._create=function(){var frame=document.createElement("div");frame.className="itemset";frame["timeline-itemset"]=this;this.dom.frame=frame;var background=document.createElement("div");background.className="background";frame.appendChild(background);this.dom.background=background;var foreground=document.createElement("div");foreground.className="foreground";frame.appendChild(foreground);this.dom.foreground=foreground;var axis=document.createElement("div");axis.className="axis";this.dom.axis=axis;var labelSet=document.createElement("div");labelSet.className="labelset";this.dom.labelSet=labelSet;this._updateUngrouped();var backgroundGroup=new BackgroundGroup(BACKGROUND,null,this);backgroundGroup.show();this.groups[BACKGROUND]=backgroundGroup;this.hammer=Hammer(this.body.dom.centerContainer,{preventDefault:true});this.hammer.on("touch",this._onTouch.bind(this));this.hammer.on("dragstart",this._onDragStart.bind(this));this.hammer.on("drag",this._onDrag.bind(this));this.hammer.on("dragend",this._onDragEnd.bind(this));this.hammer.on("tap",this._onSelectItem.bind(this));this.hammer.on("hold",this._onMultiSelectItem.bind(this));this.hammer.on("doubletap",this._onAddItem.bind(this));this.show()};ItemSet.prototype.setOptions=function(options){if(options){var fields=["type","align","order","padding","stack","selectable","groupOrder","dataAttributes","template","hide","snap"];util.selectiveExtend(fields,this.options,options);if("orientation"in options){if(typeof options.orientation==="string"){this.options.orientation=options.orientation}else if(typeof options.orientation==="object"&&"item"in options.orientation){this.options.orientation=options.orientation.item}}if("margin"in options){if(typeof options.margin==="number"){this.options.margin.axis=options.margin;this.options.margin.item.horizontal=options.margin;this.options.margin.item.vertical=options.margin}else if(typeof options.margin==="object"){util.selectiveExtend(["axis"],this.options.margin,options.margin);if("item"in options.margin){if(typeof options.margin.item==="number"){this.options.margin.item.horizontal=options.margin.item;this.options.margin.item.vertical=options.margin.item}else if(typeof options.margin.item==="object"){util.selectiveExtend(["horizontal","vertical"],this.options.margin.item,options.margin.item)}}}}if("editable"in options){if(typeof options.editable==="boolean"){this.options.editable.updateTime=options.editable;this.options.editable.updateGroup=options.editable;this.options.editable.add=options.editable;this.options.editable.remove=options.editable}else if(typeof options.editable==="object"){util.selectiveExtend(["updateTime","updateGroup","add","remove"],this.options.editable,options.editable)}}var addCallback=function(name){var fn=options[name];if(fn){if(!(fn instanceof Function)){throw new Error("option "+name+" must be a function "+name+"(item, callback)")}this.options[name]=fn}}.bind(this);["onAdd","onUpdate","onRemove","onMove","onMoving"].forEach(addCallback);this.markDirty()}};ItemSet.prototype.markDirty=function(options){this.groupIds=[];this.stackDirty=true;if(options&&options.refreshItems){util.forEach(this.items,function(item){item.dirty=true;if(item.displayed)item.redraw()})}};ItemSet.prototype.destroy=function(){this.hide();this.setItems(null);this.setGroups(null);this.hammer=null;this.body=null;this.conversion=null};ItemSet.prototype.hide=function(){if(this.dom.frame.parentNode){this.dom.frame.parentNode.removeChild(this.dom.frame)}if(this.dom.axis.parentNode){this.dom.axis.parentNode.removeChild(this.dom.axis)}if(this.dom.labelSet.parentNode){this.dom.labelSet.parentNode.removeChild(this.dom.labelSet)}};ItemSet.prototype.show=function(){if(!this.dom.frame.parentNode){this.body.dom.center.appendChild(this.dom.frame)}if(!this.dom.axis.parentNode){this.body.dom.backgroundVertical.appendChild(this.dom.axis)}if(!this.dom.labelSet.parentNode){this.body.dom.left.appendChild(this.dom.labelSet)}};ItemSet.prototype.setSelection=function(ids){var i,ii,id,item;if(ids==undefined)ids=[];if(!Array.isArray(ids))ids=[ids];for(i=0,ii=this.selection.length;i<ii;i++){id=this.selection[i];item=this.items[id];if(item)item.unselect()}this.selection=[];for(i=0,ii=ids.length;i<ii;i++){id=ids[i];item=this.items[id];if(item){this.selection.push(id);item.select()}}};ItemSet.prototype.getSelection=function(){return this.selection.concat([])};ItemSet.prototype.getVisibleItems=function(){var range=this.body.range.getRange();var left=this.body.util.toScreen(range.start);var right=this.body.util.toScreen(range.end);var ids=[];for(var groupId in this.groups){if(this.groups.hasOwnProperty(groupId)){var group=this.groups[groupId];var rawVisibleItems=group.visibleItems;for(var i=0;i<rawVisibleItems.length;i++){var item=rawVisibleItems[i];if(item.left<right&&item.left+item.width>left){ids.push(item.id)}}}}return ids};ItemSet.prototype._deselect=function(id){var selection=this.selection;for(var i=0,ii=selection.length;i<ii;i++){if(selection[i]==id){selection.splice(i,1);break}}};ItemSet.prototype.redraw=function(){var margin=this.options.margin,range=this.body.range,asSize=util.option.asSize,options=this.options,orientation=options.orientation,resized=false,frame=this.dom.frame,editable=options.editable.updateTime||options.editable.updateGroup;this.props.top=this.body.domProps.top.height+this.body.domProps.border.top;this.props.left=this.body.domProps.left.width+this.body.domProps.border.left;frame.className="itemset"+(editable?" editable":"");resized=this._orderGroups()||resized;var visibleInterval=range.end-range.start;var zoomed=visibleInterval!=this.lastVisibleInterval||this.props.width!=this.props.lastWidth;if(zoomed)this.stackDirty=true;this.lastVisibleInterval=visibleInterval;this.props.lastWidth=this.props.width;var restack=this.stackDirty;var firstGroup=this._firstGroup();var firstMargin={item:margin.item,axis:margin.axis};var nonFirstMargin={item:margin.item,axis:margin.item.vertical/2};var height=0;var minHeight=margin.axis+margin.item.vertical;this.groups[BACKGROUND].redraw(range,nonFirstMargin,restack);util.forEach(this.groups,function(group){var groupMargin=group==firstGroup?firstMargin:nonFirstMargin;var groupResized=group.redraw(range,groupMargin,restack);resized=groupResized||resized;height+=group.height});height=Math.max(height,minHeight);this.stackDirty=false;frame.style.height=asSize(height);this.props.width=frame.offsetWidth;this.props.height=height;this.dom.axis.style.top=asSize(orientation=="top"?this.body.domProps.top.height+this.body.domProps.border.top:this.body.domProps.top.height+this.body.domProps.centerContainer.height);this.dom.axis.style.left="0";resized=this._isResized()||resized;return resized};ItemSet.prototype._firstGroup=function(){var firstGroupIndex=this.options.orientation=="top"?0:this.groupIds.length-1;var firstGroupId=this.groupIds[firstGroupIndex];var firstGroup=this.groups[firstGroupId]||this.groups[UNGROUPED];return firstGroup||null};ItemSet.prototype._updateUngrouped=function(){var ungrouped=this.groups[UNGROUPED];var background=this.groups[BACKGROUND];var item,itemId;if(this.groupsData){if(ungrouped){ungrouped.hide();delete this.groups[UNGROUPED];for(itemId in this.items){if(this.items.hasOwnProperty(itemId)){item=this.items[itemId];item.parent&&item.parent.remove(item);var groupId=this._getGroupId(item.data);var group=this.groups[groupId];group&&group.add(item)||item.hide()}}}}else{if(!ungrouped){var id=null;var data=null;ungrouped=new Group(id,data,this);this.groups[UNGROUPED]=ungrouped;for(itemId in this.items){if(this.items.hasOwnProperty(itemId)){item=this.items[itemId];ungrouped.add(item)}}ungrouped.show()}}};ItemSet.prototype.getLabelSet=function(){return this.dom.labelSet};ItemSet.prototype.setItems=function(items){var me=this,ids,oldItemsData=this.itemsData;if(!items){this.itemsData=null}else if(items instanceof DataSet||items instanceof DataView){this.itemsData=items}else{throw new TypeError("Data must be an instance of DataSet or DataView")}if(oldItemsData){util.forEach(this.itemListeners,function(callback,event){oldItemsData.off(event,callback)});ids=oldItemsData.getIds();this._onRemove(ids)}if(this.itemsData){var id=this.id;util.forEach(this.itemListeners,function(callback,event){me.itemsData.on(event,callback,id)});ids=this.itemsData.getIds();this._onAdd(ids);this._updateUngrouped()}};ItemSet.prototype.getItems=function(){return this.itemsData};ItemSet.prototype.setGroups=function(groups){var me=this,ids;if(this.groupsData){util.forEach(this.groupListeners,function(callback,event){me.groupsData.unsubscribe(event,callback)});ids=this.groupsData.getIds();this.groupsData=null;this._onRemoveGroups(ids)}if(!groups){this.groupsData=null}else if(groups instanceof DataSet||groups instanceof DataView){this.groupsData=groups}else{throw new TypeError("Data must be an instance of DataSet or DataView")}if(this.groupsData){var id=this.id;util.forEach(this.groupListeners,function(callback,event){me.groupsData.on(event,callback,id)});ids=this.groupsData.getIds();this._onAddGroups(ids)}this._updateUngrouped();this._order();this.body.emitter.emit("change",{queue:true})};ItemSet.prototype.getGroups=function(){return this.groupsData};ItemSet.prototype.removeItem=function(id){var item=this.itemsData.get(id),dataset=this.itemsData.getDataSet();if(item){this.options.onRemove(item,function(item){if(item){dataset.remove(id)}})}};ItemSet.prototype._getType=function(itemData){return itemData.type||this.options.type||(itemData.end?"range":"box")};ItemSet.prototype._getGroupId=function(itemData){var type=this._getType(itemData);if(type=="background"&&itemData.group==undefined){return BACKGROUND}else{return this.groupsData?itemData.group:UNGROUPED}};ItemSet.prototype._onUpdate=function(ids){var me=this;ids.forEach(function(id){var itemData=me.itemsData.get(id,me.itemOptions);var item=me.items[id];var type=me._getType(itemData);var constructor=ItemSet.types[type];if(item){if(!constructor||!(item instanceof constructor)){me._removeItem(item);item=null}else{me._updateItem(item,itemData)}}if(!item){if(constructor){item=new constructor(itemData,me.conversion,me.options);item.id=id;me._addItem(item)}else if(type=="rangeoverflow"){throw new TypeError('Item type "rangeoverflow" is deprecated. Use css styling instead: '+".vis.timeline .item.range .content {overflow: visible;}")}else{throw new TypeError('Unknown item type "'+type+'"')}}});this._order();this.stackDirty=true;this.body.emitter.emit("change",{queue:true})};ItemSet.prototype._onAdd=ItemSet.prototype._onUpdate;ItemSet.prototype._onRemove=function(ids){var count=0;var me=this;ids.forEach(function(id){var item=me.items[id];if(item){count++;me._removeItem(item)}});if(count){this._order();this.stackDirty=true;this.body.emitter.emit("change",{queue:true})}};ItemSet.prototype._order=function(){util.forEach(this.groups,function(group){group.order()})};ItemSet.prototype._onUpdateGroups=function(ids){this._onAddGroups(ids)};ItemSet.prototype._onAddGroups=function(ids){var me=this;ids.forEach(function(id){var groupData=me.groupsData.get(id);var group=me.groups[id];if(!group){if(id==UNGROUPED||id==BACKGROUND){throw new Error("Illegal group id. "+id+" is a reserved id.")}var groupOptions=Object.create(me.options);util.extend(groupOptions,{height:null});group=new Group(id,groupData,me);me.groups[id]=group;for(var itemId in me.items){if(me.items.hasOwnProperty(itemId)){var item=me.items[itemId];if(item.data.group==id){group.add(item)}}}group.order();group.show()}else{group.setData(groupData)}});this.body.emitter.emit("change",{queue:true})};ItemSet.prototype._onRemoveGroups=function(ids){var groups=this.groups;ids.forEach(function(id){var group=groups[id];if(group){group.hide();delete groups[id]}});this.markDirty();this.body.emitter.emit("change",{queue:true})};ItemSet.prototype._orderGroups=function(){if(this.groupsData){var groupIds=this.groupsData.getIds({order:this.options.groupOrder});var changed=!util.equalArray(groupIds,this.groupIds);if(changed){var groups=this.groups;groupIds.forEach(function(groupId){groups[groupId].hide()});groupIds.forEach(function(groupId){groups[groupId].show()});this.groupIds=groupIds}return changed}else{return false}};ItemSet.prototype._addItem=function(item){this.items[item.id]=item;var groupId=this._getGroupId(item.data);var group=this.groups[groupId];if(group)group.add(item)};ItemSet.prototype._updateItem=function(item,itemData){var oldGroupId=item.data.group;item.setData(itemData);if(oldGroupId!=item.data.group){var oldGroup=this.groups[oldGroupId];if(oldGroup)oldGroup.remove(item);var groupId=this._getGroupId(item.data);var group=this.groups[groupId];if(group)group.add(item)}};ItemSet.prototype._removeItem=function(item){item.hide();delete this.items[item.id];var index=this.selection.indexOf(item.id);if(index!=-1)this.selection.splice(index,1);item.parent&&item.parent.remove(item)};ItemSet.prototype._constructByEndArray=function(array){var endArray=[];for(var i=0;i<array.length;i++){if(array[i]instanceof RangeItem){endArray.push(array[i])}}return endArray};ItemSet.prototype._onTouch=function(event){this.touchParams.item=this.itemFromTarget(event)};ItemSet.prototype._onDragStart=function(event){if(!this.options.editable.updateTime&&!this.options.editable.updateGroup){return}var item=this.touchParams.item||null;var me=this;var props;if(item&&item.selected){var dragLeftItem=event.target.dragLeftItem;var dragRightItem=event.target.dragRightItem;if(dragLeftItem){props={item:dragLeftItem,initialX:event.gesture.center.pageX,dragLeft:true,data:util.extend({},item.data)};this.touchParams.itemProps=[props]}else if(dragRightItem){props={item:dragRightItem,initialX:event.gesture.center.pageX,dragRight:true,data:util.extend({},item.data)};this.touchParams.itemProps=[props]}else{this.touchParams.itemProps=this.getSelection().map(function(id){var item=me.items[id];var props={item:item,initialX:event.gesture.center.pageX,data:util.extend({},item.data)};return props})}event.stopPropagation()}else if(this.options.editable.add&&event.gesture.srcEvent.ctrlKey){this._onDragStartAddItem(event)}};ItemSet.prototype._onDragStartAddItem=function(event){var snap=this.options.snap||null;var xAbs=util.getAbsoluteLeft(this.dom.frame);var x=event.gesture.center.pageX-xAbs-10;var time=this.body.util.toTime(x);var scale=this.body.util.getScale();var step=this.body.util.getStep();var start=snap?snap(time,scale,step):start;var end=start;var itemData={type:"range",start:start,end:end,content:"new item"};var id=util.randomUUID();itemData[this.itemsData._fieldId]=id;var group=this.groupFromTarget(event);if(group){itemData.group=group.groupId}var newItem=new RangeItem(itemData,this.conversion,this.options);newItem.id=id;newItem.data=itemData;this._addItem(newItem);var props={item:newItem,dragRight:true,initialX:event.gesture.center.pageX,data:util.extend({},itemData)};this.touchParams.itemProps=[props];event.stopPropagation()};ItemSet.prototype._onDrag=function(event){event.preventDefault();if(this.touchParams.itemProps){event.stopPropagation();var me=this;var snap=this.options.snap||null;var xOffset=this.body.dom.root.offsetLeft+this.body.domProps.left.width;var scale=this.body.util.getScale();var step=this.body.util.getStep();this.touchParams.itemProps.forEach(function(props){var current=me.body.util.toTime(event.gesture.center.pageX-xOffset);var initial=me.body.util.toTime(props.initialX-xOffset);var offset=current-initial;var itemData=util.extend({},props.item.data);if(me.options.editable.updateTime){if(props.dragLeft){if(itemData.start!=undefined){var initialStart=util.convert(props.data.start,"Date");var start=new Date(initialStart.valueOf()+offset);itemData.start=snap?snap(start,scale,step):start}}else if(props.dragRight){if(itemData.end!=undefined){var initialEnd=util.convert(props.data.end,"Date");var end=new Date(initialEnd.valueOf()+offset);itemData.end=snap?snap(end,scale,step):end}}else{if(itemData.start!=undefined){var initialStart=util.convert(props.data.start,"Date").valueOf();var start=new Date(initialStart+offset);if(itemData.end!=undefined){var initialEnd=util.convert(props.data.end,"Date");var duration=initialEnd.valueOf()-initialStart.valueOf();itemData.start=snap?snap(start,scale,step):start;itemData.end=new Date(itemData.start.valueOf()+duration)}else{itemData.start=snap?snap(start,scale,step):start}}}}if(me.options.editable.updateGroup&&(!props.dragLeft&&!props.dragRight)){if(itemData.group!=undefined){var group=me.groupFromTarget(event);if(group){itemData.group=group.groupId}}}me.options.onMoving(itemData,function(itemData){if(itemData){props.item.setData(itemData)}})});this.stackDirty=true;this.body.emitter.emit("change")}};ItemSet.prototype._moveToGroup=function(item,groupId){var group=this.groups[groupId];if(group&&group.groupId!=item.data.group){var oldGroup=item.parent;oldGroup.remove(item);oldGroup.order();group.add(item);group.order();item.data.group=group.groupId}};ItemSet.prototype._onDragEnd=function(event){event.preventDefault();if(this.touchParams.itemProps){event.stopPropagation();var changes=[];var me=this;var dataset=this.itemsData.getDataSet();var itemProps=this.touchParams.itemProps;this.touchParams.itemProps=null;itemProps.forEach(function(props){var id=props.item.id;var exists=me.itemsData.get(id,me.itemOptions)!=null;if(!exists){me.options.onAdd(props.item.data,function(itemData){me._removeItem(props.item);if(itemData){me.itemsData.getDataSet().add(itemData)}me.stackDirty=true;me.body.emitter.emit("change")})}else{var itemData=util.extend({},props.item.data);me.options.onMove(itemData,function(itemData){if(itemData){itemData[dataset._fieldId]=id;changes.push(itemData)}else{props.item.setData(props.data);me.stackDirty=true;me.body.emitter.emit("change")}})}});if(changes.length){dataset.update(changes)}}};ItemSet.prototype._onSelectItem=function(event){if(!this.options.selectable)return;var ctrlKey=event.gesture.srcEvent&&event.gesture.srcEvent.ctrlKey;var shiftKey=event.gesture.srcEvent&&event.gesture.srcEvent.shiftKey;if(ctrlKey||shiftKey){this._onMultiSelectItem(event);return}var oldSelection=this.getSelection();var item=this.itemFromTarget(event);var selection=item?[item.id]:[];this.setSelection(selection);var newSelection=this.getSelection();if(newSelection.length>0||oldSelection.length>0){this.body.emitter.emit("select",{items:newSelection})}};ItemSet.prototype._onAddItem=function(event){if(!this.options.selectable)return;if(!this.options.editable.add)return;var me=this,snap=this.options.snap||null,item=this.itemFromTarget(event);if(item){var itemData=me.itemsData.get(item.id);this.options.onUpdate(itemData,function(itemData){if(itemData){me.itemsData.getDataSet().update(itemData)}})}else{var xAbs=util.getAbsoluteLeft(this.dom.frame);var x=event.gesture.center.pageX-xAbs;var start=this.body.util.toTime(x);var scale=this.body.util.getScale();var step=this.body.util.getStep();var newItem={start:snap?snap(start,scale,step):start,content:"new item"};if(this.options.type==="range"){var end=this.body.util.toTime(x+this.props.width/5);newItem.end=snap?snap(end,scale,step):end}newItem[this.itemsData._fieldId]=util.randomUUID();var group=this.groupFromTarget(event);if(group){newItem.group=group.groupId}this.options.onAdd(newItem,function(item){if(item){me.itemsData.getDataSet().add(item)}})}};ItemSet.prototype._onMultiSelectItem=function(event){if(!this.options.selectable)return;var selection,item=this.itemFromTarget(event);if(item){selection=this.getSelection();var shiftKey=event.gesture.touches[0]&&event.gesture.touches[0].shiftKey||false;if(shiftKey){selection.push(item.id);var range=ItemSet._getItemRange(this.itemsData.get(selection,this.itemOptions));selection=[];for(var id in this.items){if(this.items.hasOwnProperty(id)){var _item=this.items[id];var start=_item.data.start;var end=_item.data.end!==undefined?_item.data.end:start;if(start>=range.min&&end<=range.max&&!(_item instanceof BackgroundItem)){selection.push(_item.id)}}}}else{var index=selection.indexOf(item.id);if(index==-1){selection.push(item.id)}else{selection.splice(index,1)}}this.setSelection(selection);this.body.emitter.emit("select",{items:this.getSelection()})}};ItemSet._getItemRange=function(itemsData){var max=null;var min=null;itemsData.forEach(function(data){if(min==null||data.start<min){min=data.start}if(data.end!=undefined){if(max==null||data.end>max){max=data.end}}else{if(max==null||data.start>max){max=data.start}}});return{min:min,max:max}};ItemSet.prototype.itemFromTarget=function(event){var target=event.target;while(target){if(target.hasOwnProperty("timeline-item")){return target["timeline-item"]}target=target.parentNode}return null};ItemSet.prototype.groupFromTarget=function(event){var pageY=event.gesture?event.gesture.center.pageY:event.pageY;for(var i=0;i<this.groupIds.length;i++){var groupId=this.groupIds[i];var group=this.groups[groupId];var foreground=group.dom.foreground;var top=util.getAbsoluteTop(foreground);if(pageY>top&&pageY<top+foreground.offsetHeight){return group}if(this.options.orientation==="top"){if(i===this.groupIds.length-1&&pageY>top){return group}}else{if(i===0&&pageY<top+foreground.offset){return group}}}return null};ItemSet.itemSetFromTarget=function(event){var target=event.target;while(target){if(target.hasOwnProperty("timeline-itemset")){return target["timeline-itemset"]}target=target.parentNode}return null};module.exports=ItemSet},{"../../DataSet":2,"../../DataView":3,"../../module/hammer":6,"../../util":28,"../TimeStep":13,"./BackgroundGroup":15,"./Component":16,"./Group":19,"./item/BackgroundItem":22,"./item/BoxItem":23,"./item/PointItem":25,"./item/RangeItem":26}],21:[function(require,module,exports){var util=require("../../util");var Component=require("./Component");var TimeStep=require("../TimeStep");var DateUtil=require("../DateUtil");var moment=require("../../module/moment");function TimeAxis(body,options){this.dom={foreground:null,lines:[],majorTexts:[],minorTexts:[],redundant:{lines:[],majorTexts:[],minorTexts:[]}};this.props={range:{start:0,end:0,minimumStep:0},lineTop:0};this.defaultOptions={orientation:"bottom",showMinorLabels:true,showMajorLabels:true,format:null,timeAxis:null};this.options=util.extend({},this.defaultOptions);this.body=body;this._create();this.setOptions(options)}TimeAxis.prototype=new Component;TimeAxis.prototype.setOptions=function(options){if(options){util.selectiveExtend(["showMinorLabels","showMajorLabels","hiddenDates","format","timeAxis"],this.options,options);if("orientation"in options){if(typeof options.orientation==="string"){this.options.orientation=options.orientation}else if(typeof options.orientation==="object"&&"axis"in options.orientation){this.options.orientation=options.orientation.axis}}if("locale"in options){if(typeof moment.locale==="function"){moment.locale(options.locale)}else{moment.lang(options.locale)}}}};TimeAxis.prototype._create=function(){this.dom.foreground=document.createElement("div");this.dom.background=document.createElement("div");this.dom.foreground.className="timeaxis foreground";this.dom.background.className="timeaxis background"};TimeAxis.prototype.destroy=function(){if(this.dom.foreground.parentNode){this.dom.foreground.parentNode.removeChild(this.dom.foreground)}if(this.dom.background.parentNode){this.dom.background.parentNode.removeChild(this.dom.background)}this.body=null};TimeAxis.prototype.redraw=function(){var options=this.options;var props=this.props;var foreground=this.dom.foreground;var background=this.dom.background;var parent=options.orientation=="top"?this.body.dom.top:this.body.dom.bottom;var parentChanged=foreground.parentNode!==parent;this._calculateCharSize();var showMinorLabels=this.options.showMinorLabels;var showMajorLabels=this.options.showMajorLabels;props.minorLabelHeight=showMinorLabels?props.minorCharHeight:0;props.majorLabelHeight=showMajorLabels?props.majorCharHeight:0;props.height=props.minorLabelHeight+props.majorLabelHeight;props.width=foreground.offsetWidth;props.minorLineHeight=this.body.domProps.root.height-props.majorLabelHeight-(options.orientation=="top"?this.body.domProps.bottom.height:this.body.domProps.top.height);props.minorLineWidth=1;props.majorLineHeight=props.minorLineHeight+props.majorLabelHeight;props.majorLineWidth=1;var foregroundNextSibling=foreground.nextSibling;var backgroundNextSibling=background.nextSibling;foreground.parentNode&&foreground.parentNode.removeChild(foreground);background.parentNode&&background.parentNode.removeChild(background);foreground.style.height=this.props.height+"px";this._repaintLabels();if(foregroundNextSibling){parent.insertBefore(foreground,foregroundNextSibling)}else{parent.appendChild(foreground)}if(backgroundNextSibling){this.body.dom.backgroundVertical.insertBefore(background,backgroundNextSibling)}else{this.body.dom.backgroundVertical.appendChild(background)}return this._isResized()||parentChanged};TimeAxis.prototype._repaintLabels=function(){var orientation=this.options.orientation;var start=util.convert(this.body.range.start,"Number");var end=util.convert(this.body.range.end,"Number");var timeLabelsize=this.body.util.toTime((this.props.minorCharWidth||10)*7).valueOf();var minimumStep=timeLabelsize-DateUtil.getHiddenDurationBefore(this.body.hiddenDates,this.body.range,timeLabelsize);minimumStep-=this.body.util.toTime(0).valueOf();var step=new TimeStep(new Date(start),new Date(end),minimumStep,this.body.hiddenDates);if(this.options.format){step.setFormat(this.options.format)}if(this.options.timeAxis){step.setScale(this.options.timeAxis)}this.step=step;var dom=this.dom;dom.redundant.lines=dom.lines;dom.redundant.majorTexts=dom.majorTexts;dom.redundant.minorTexts=dom.minorTexts;dom.lines=[];dom.majorTexts=[];dom.minorTexts=[];var cur;var x=0;var isMajor;var xPrev=0;var width=0;var prevLine;var xFirstMajorLabel=undefined;var max=0;var className;step.first();while(step.hasNext()&&max<1e3){max++;cur=step.getCurrent();isMajor=step.isMajor();className=step.getClassName();xPrev=x;x=this.body.util.toScreen(cur);width=x-xPrev;if(prevLine){prevLine.style.width=width+"px"}if(this.options.showMinorLabels){this._repaintMinorText(x,step.getLabelMinor(),orientation,className)}if(isMajor&&this.options.showMajorLabels){if(x>0){if(xFirstMajorLabel==undefined){xFirstMajorLabel=x}this._repaintMajorText(x,step.getLabelMajor(),orientation,className)}prevLine=this._repaintMajorLine(x,orientation,className)}else{prevLine=this._repaintMinorLine(x,orientation,className)}step.next()}if(this.options.showMajorLabels){var leftTime=this.body.util.toTime(0),leftText=step.getLabelMajor(leftTime),widthText=leftText.length*(this.props.majorCharWidth||10)+10;if(xFirstMajorLabel==undefined||widthText<xFirstMajorLabel){this._repaintMajorText(0,leftText,orientation,className)}}util.forEach(this.dom.redundant,function(arr){while(arr.length){var elem=arr.pop();if(elem&&elem.parentNode){elem.parentNode.removeChild(elem)}}})};TimeAxis.prototype._repaintMinorText=function(x,text,orientation,className){var label=this.dom.redundant.minorTexts.shift();if(!label){var content=document.createTextNode("");label=document.createElement("div");label.appendChild(content);this.dom.foreground.appendChild(label)}this.dom.minorTexts.push(label);label.childNodes[0].nodeValue=text;label.style.top=orientation=="top"?this.props.majorLabelHeight+"px":"0";label.style.left=x+"px";label.className="text minor "+className};TimeAxis.prototype._repaintMajorText=function(x,text,orientation,className){var label=this.dom.redundant.majorTexts.shift();if(!label){var content=document.createTextNode(text);label=document.createElement("div");label.appendChild(content);this.dom.foreground.appendChild(label)}this.dom.majorTexts.push(label);label.childNodes[0].nodeValue=text;label.className="text major "+className;label.style.top=orientation=="top"?"0":this.props.minorLabelHeight+"px";label.style.left=x+"px"};TimeAxis.prototype._repaintMinorLine=function(x,orientation,className){var line=this.dom.redundant.lines.shift();if(!line){line=document.createElement("div");this.dom.background.appendChild(line)}this.dom.lines.push(line);var props=this.props;if(orientation=="top"){line.style.top=props.majorLabelHeight+"px"}else{line.style.top=this.body.domProps.top.height+"px"}line.style.height=props.minorLineHeight+"px";line.style.left=x-props.minorLineWidth/2+"px";line.className="grid vertical minor "+className;return line};TimeAxis.prototype._repaintMajorLine=function(x,orientation,className){var line=this.dom.redundant.lines.shift();if(!line){line=document.createElement("div");this.dom.background.appendChild(line)}this.dom.lines.push(line);var props=this.props;if(orientation=="top"){line.style.top="0"}else{line.style.top=this.body.domProps.top.height+"px"}line.style.left=x-props.majorLineWidth/2+"px";line.style.height=props.majorLineHeight+"px";line.className="grid vertical major "+className;return line};TimeAxis.prototype._calculateCharSize=function(){if(!this.dom.measureCharMinor){this.dom.measureCharMinor=document.createElement("DIV");this.dom.measureCharMinor.className="text minor measure";this.dom.measureCharMinor.style.position="absolute";this.dom.measureCharMinor.appendChild(document.createTextNode("0"));this.dom.foreground.appendChild(this.dom.measureCharMinor)}this.props.minorCharHeight=this.dom.measureCharMinor.clientHeight;this.props.minorCharWidth=this.dom.measureCharMinor.clientWidth;if(!this.dom.measureCharMajor){this.dom.measureCharMajor=document.createElement("DIV");

this.dom.measureCharMajor.className="text major measure";this.dom.measureCharMajor.style.position="absolute";this.dom.measureCharMajor.appendChild(document.createTextNode("0"));this.dom.foreground.appendChild(this.dom.measureCharMajor)}this.props.majorCharHeight=this.dom.measureCharMajor.clientHeight;this.props.majorCharWidth=this.dom.measureCharMajor.clientWidth};module.exports=TimeAxis},{"../../module/moment":7,"../../util":28,"../DateUtil":10,"../TimeStep":13,"./Component":16}],22:[function(require,module,exports){var Hammer=require("../../../module/hammer");var Item=require("./Item");var BackgroundGroup=require("../BackgroundGroup");var RangeItem=require("./RangeItem");function BackgroundItem(data,conversion,options){this.props={content:{width:0}};this.overflow=false;if(data){if(data.start==undefined){throw new Error('Property "start" missing in item '+data.id)}if(data.end==undefined){throw new Error('Property "end" missing in item '+data.id)}}Item.call(this,data,conversion,options);this.emptyContent=false}BackgroundItem.prototype=new Item(null,null,null);BackgroundItem.prototype.baseClassName="item background";BackgroundItem.prototype.stack=false;BackgroundItem.prototype.isVisible=function(range){return this.data.start<range.end&&this.data.end>range.start};BackgroundItem.prototype.redraw=function(){var dom=this.dom;if(!dom){this.dom={};dom=this.dom;dom.box=document.createElement("div");dom.content=document.createElement("div");dom.content.className="content";dom.box.appendChild(dom.content);this.dirty=true}if(!this.parent){throw new Error("Cannot redraw item: no parent attached")}if(!dom.box.parentNode){var background=this.parent.dom.background;if(!background){throw new Error("Cannot redraw item: parent has no background container element")}background.appendChild(dom.box)}this.displayed=true;if(this.dirty){this._updateContents(this.dom.content);this._updateTitle(this.dom.content);this._updateDataAttributes(this.dom.content);this._updateStyle(this.dom.box);var className=(this.data.className?" "+this.data.className:"")+(this.selected?" selected":"");dom.box.className=this.baseClassName+className;this.overflow=window.getComputedStyle(dom.content).overflow!=="hidden";this.props.content.width=this.dom.content.offsetWidth;this.height=0;this.dirty=false}};BackgroundItem.prototype.show=RangeItem.prototype.show;BackgroundItem.prototype.hide=RangeItem.prototype.hide;BackgroundItem.prototype.repositionX=RangeItem.prototype.repositionX;BackgroundItem.prototype.repositionY=function(margin){var onTop=this.options.orientation==="top";this.dom.content.style.top=onTop?"":"0";this.dom.content.style.bottom=onTop?"0":"";var height;if(this.data.subgroup!==undefined){var itemSubgroup=this.data.subgroup;var subgroups=this.parent.subgroups;var subgroupIndex=subgroups[itemSubgroup].index;if(onTop==true){height=this.parent.subgroups[itemSubgroup].height+margin.item.vertical;height+=subgroupIndex==0?margin.axis-.5*margin.item.vertical:0;var newTop=this.parent.top;for(var subgroup in subgroups){if(subgroups.hasOwnProperty(subgroup)){if(subgroups[subgroup].visible==true&&subgroups[subgroup].index<subgroupIndex){newTop+=subgroups[subgroup].height+margin.item.vertical}}}newTop+=subgroupIndex!=0?margin.axis-.5*margin.item.vertical:0;this.dom.box.style.top=newTop+"px";this.dom.box.style.bottom=""}else{var newTop=this.parent.top;var totalHeight=0;for(var subgroup in subgroups){if(subgroups.hasOwnProperty(subgroup)){if(subgroups[subgroup].visible==true){var newHeight=subgroups[subgroup].height+margin.item.vertical;totalHeight+=newHeight;if(subgroups[subgroup].index>subgroupIndex){newTop+=newHeight}}}}height=this.parent.subgroups[itemSubgroup].height+margin.item.vertical;this.dom.box.style.top=this.parent.height-totalHeight+newTop+"px";this.dom.box.style.bottom=""}}else{if(this.parent instanceof BackgroundGroup){height=Math.max(this.parent.height,this.parent.itemSet.body.domProps.center.height,this.parent.itemSet.body.domProps.centerContainer.height);this.dom.box.style.top=onTop?"0":"";this.dom.box.style.bottom=onTop?"":"0"}else{height=this.parent.height;this.dom.box.style.top=this.parent.top+"px";this.dom.box.style.bottom=""}}this.dom.box.style.height=height+"px"};module.exports=BackgroundItem},{"../../../module/hammer":6,"../BackgroundGroup":15,"./Item":24,"./RangeItem":26}],23:[function(require,module,exports){var Item=require("./Item");var util=require("../../../util");function BoxItem(data,conversion,options){this.props={dot:{width:0,height:0},line:{width:0,height:0}};if(data){if(data.start==undefined){throw new Error('Property "start" missing in item '+data)}}Item.call(this,data,conversion,options)}BoxItem.prototype=new Item(null,null,null);BoxItem.prototype.isVisible=function(range){var interval=(range.end-range.start)/4;return this.data.start>range.start-interval&&this.data.start<range.end+interval};BoxItem.prototype.redraw=function(){var dom=this.dom;if(!dom){this.dom={};dom=this.dom;dom.box=document.createElement("DIV");dom.content=document.createElement("DIV");dom.content.className="content";dom.box.appendChild(dom.content);dom.line=document.createElement("DIV");dom.line.className="line";dom.dot=document.createElement("DIV");dom.dot.className="dot";dom.box["timeline-item"]=this;this.dirty=true}if(!this.parent){throw new Error("Cannot redraw item: no parent attached")}if(!dom.box.parentNode){var foreground=this.parent.dom.foreground;if(!foreground)throw new Error("Cannot redraw item: parent has no foreground container element");foreground.appendChild(dom.box)}if(!dom.line.parentNode){var background=this.parent.dom.background;if(!background)throw new Error("Cannot redraw item: parent has no background container element");background.appendChild(dom.line)}if(!dom.dot.parentNode){var axis=this.parent.dom.axis;if(!background)throw new Error("Cannot redraw item: parent has no axis container element");axis.appendChild(dom.dot)}this.displayed=true;if(this.dirty){this._updateContents(this.dom.content);this._updateTitle(this.dom.box);this._updateDataAttributes(this.dom.box);this._updateStyle(this.dom.box);var className=(this.data.className?" "+this.data.className:"")+(this.selected?" selected":"");dom.box.className="item box"+className;dom.line.className="item line"+className;dom.dot.className="item dot"+className;this.props.dot.height=dom.dot.offsetHeight;this.props.dot.width=dom.dot.offsetWidth;this.props.line.width=dom.line.offsetWidth;this.width=dom.box.offsetWidth;this.height=dom.box.offsetHeight;this.dirty=false}this._repaintDeleteButton(dom.box)};BoxItem.prototype.show=function(){if(!this.displayed){this.redraw()}};BoxItem.prototype.hide=function(){if(this.displayed){var dom=this.dom;if(dom.box.parentNode)dom.box.parentNode.removeChild(dom.box);if(dom.line.parentNode)dom.line.parentNode.removeChild(dom.line);if(dom.dot.parentNode)dom.dot.parentNode.removeChild(dom.dot);this.displayed=false}};BoxItem.prototype.repositionX=function(){var start=this.conversion.toScreen(this.data.start);var align=this.options.align;var left;if(align=="right"){this.left=start-this.width}else if(align=="left"){this.left=start}else{this.left=start-this.width/2}this.dom.box.style.left=this.left+"px";this.dom.line.style.left=start-this.props.line.width/2+"px";this.dom.dot.style.left=start-this.props.dot.width/2+"px"};BoxItem.prototype.repositionY=function(){var orientation=this.options.orientation;var box=this.dom.box;var line=this.dom.line;var dot=this.dom.dot;if(orientation=="top"){box.style.top=(this.top||0)+"px";line.style.top="0";line.style.height=this.parent.top+this.top+1+"px";line.style.bottom=""}else{var itemSetHeight=this.parent.itemSet.props.height;var lineHeight=itemSetHeight-this.parent.top-this.parent.height+this.top;box.style.top=(this.parent.height-this.top-this.height||0)+"px";line.style.top=itemSetHeight-lineHeight+"px";line.style.bottom="0"}dot.style.top=-this.props.dot.height/2+"px"};module.exports=BoxItem},{"../../../util":28,"./Item":24}],24:[function(require,module,exports){var Hammer=require("../../../module/hammer");var util=require("../../../util");function Item(data,conversion,options){this.id=null;this.parent=null;this.data=data;this.dom=null;this.conversion=conversion||{};this.options=options||{};this.selected=false;this.displayed=false;this.dirty=true;this.top=null;this.left=null;this.width=null;this.height=null}Item.prototype.stack=true;Item.prototype.select=function(){this.selected=true;this.dirty=true;if(this.displayed)this.redraw()};Item.prototype.unselect=function(){this.selected=false;this.dirty=true;if(this.displayed)this.redraw()};Item.prototype.setData=function(data){var groupChanged=data.group!=undefined&&this.data.group!=data.group;if(groupChanged){this.parent.itemSet._moveToGroup(this,data.group)}this.data=data;this.dirty=true;if(this.displayed)this.redraw()};Item.prototype.setParent=function(parent){if(this.displayed){this.hide();this.parent=parent;if(this.parent){this.show()}}else{this.parent=parent}};Item.prototype.isVisible=function(range){return false};Item.prototype.show=function(){return false};Item.prototype.hide=function(){return false};Item.prototype.redraw=function(){};Item.prototype.repositionX=function(){};Item.prototype.repositionY=function(){};Item.prototype._repaintDeleteButton=function(anchor){if(this.selected&&this.options.editable.remove&&!this.dom.deleteButton){var me=this;var deleteButton=document.createElement("div");deleteButton.className="delete";deleteButton.title="Delete this item";Hammer(deleteButton,{preventDefault:true}).on("tap",function(event){event.preventDefault();event.stopPropagation();me.parent.removeFromDataSet(me)});anchor.appendChild(deleteButton);this.dom.deleteButton=deleteButton}else if(!this.selected&&this.dom.deleteButton){if(this.dom.deleteButton.parentNode){this.dom.deleteButton.parentNode.removeChild(this.dom.deleteButton)}this.dom.deleteButton=null}};Item.prototype._updateContents=function(element){var content;if(this.options.template){var itemData=this.parent.itemSet.itemsData.get(this.id);content=this.options.template(itemData)}else{content=this.data.content}if(content!==this.content){if(content instanceof Element){element.innerHTML="";element.appendChild(content)}else if(content!=undefined){element.innerHTML=content}else{if(!(this.data.type=="background"&&this.data.content===undefined)){throw new Error('Property "content" missing in item '+this.id)}}this.content=content}};Item.prototype._updateTitle=function(element){if(this.data.title!=null){element.title=this.data.title||""}else{element.removeAttribute("title")}};Item.prototype._updateDataAttributes=function(element){if(this.options.dataAttributes&&this.options.dataAttributes.length>0){var attributes=[];if(Array.isArray(this.options.dataAttributes)){attributes=this.options.dataAttributes}else if(this.options.dataAttributes=="all"){attributes=Object.keys(this.data)}else{return}for(var i=0;i<attributes.length;i++){var name=attributes[i];var value=this.data[name];if(value!=null){element.setAttribute("data-"+name,value)}else{element.removeAttribute("data-"+name)}}}};Item.prototype._updateStyle=function(element){if(this.style){util.removeCssText(element,this.style);this.style=null}if(this.data.style){util.addCssText(element,this.data.style);this.style=this.data.style}};module.exports=Item},{"../../../module/hammer":6,"../../../util":28}],25:[function(require,module,exports){var Item=require("./Item");function PointItem(data,conversion,options){this.props={dot:{top:0,width:0,height:0},content:{height:0,marginLeft:0}};if(data){if(data.start==undefined){throw new Error('Property "start" missing in item '+data)}}Item.call(this,data,conversion,options)}PointItem.prototype=new Item(null,null,null);PointItem.prototype.isVisible=function(range){var interval=(range.end-range.start)/4;return this.data.start>range.start-interval&&this.data.start<range.end+interval};PointItem.prototype.redraw=function(){var dom=this.dom;if(!dom){this.dom={};dom=this.dom;dom.point=document.createElement("div");dom.content=document.createElement("div");dom.content.className="content";dom.point.appendChild(dom.content);dom.dot=document.createElement("div");dom.point.appendChild(dom.dot);dom.point["timeline-item"]=this;this.dirty=true}if(!this.parent){throw new Error("Cannot redraw item: no parent attached")}if(!dom.point.parentNode){var foreground=this.parent.dom.foreground;if(!foreground){throw new Error("Cannot redraw item: parent has no foreground container element")}foreground.appendChild(dom.point)}this.displayed=true;if(this.dirty){this._updateContents(this.dom.content);this._updateTitle(this.dom.point);this._updateDataAttributes(this.dom.point);this._updateStyle(this.dom.point);var className=(this.data.className?" "+this.data.className:"")+(this.selected?" selected":"");dom.point.className="item point"+className;dom.dot.className="item dot"+className;this.width=dom.point.offsetWidth;this.height=dom.point.offsetHeight;this.props.dot.width=dom.dot.offsetWidth;this.props.dot.height=dom.dot.offsetHeight;this.props.content.height=dom.content.offsetHeight;dom.content.style.marginLeft=2*this.props.dot.width+"px";dom.dot.style.top=(this.height-this.props.dot.height)/2+"px";dom.dot.style.left=this.props.dot.width/2+"px";this.dirty=false}this._repaintDeleteButton(dom.point)};PointItem.prototype.show=function(){if(!this.displayed){this.redraw()}};PointItem.prototype.hide=function(){if(this.displayed){if(this.dom.point.parentNode){this.dom.point.parentNode.removeChild(this.dom.point)}this.displayed=false}};PointItem.prototype.repositionX=function(){var start=this.conversion.toScreen(this.data.start);this.left=start-this.props.dot.width;this.dom.point.style.left=this.left+"px"};PointItem.prototype.repositionY=function(){var orientation=this.options.orientation,point=this.dom.point;if(orientation=="top"){point.style.top=this.top+"px"}else{point.style.top=this.parent.height-this.top-this.height+"px"}};module.exports=PointItem},{"./Item":24}],26:[function(require,module,exports){var Hammer=require("../../../module/hammer");var Item=require("./Item");function RangeItem(data,conversion,options){this.props={content:{width:0}};this.overflow=false;if(data){if(data.start==undefined){throw new Error('Property "start" missing in item '+data.id)}if(data.end==undefined){throw new Error('Property "end" missing in item '+data.id)}}Item.call(this,data,conversion,options)}RangeItem.prototype=new Item(null,null,null);RangeItem.prototype.baseClassName="item range";RangeItem.prototype.isVisible=function(range){return this.data.start<range.end&&this.data.end>range.start};RangeItem.prototype.redraw=function(){var dom=this.dom;if(!dom){this.dom={};dom=this.dom;dom.box=document.createElement("div");dom.content=document.createElement("div");dom.content.className="content";dom.box.appendChild(dom.content);dom.box["timeline-item"]=this;this.dirty=true}if(!this.parent){throw new Error("Cannot redraw item: no parent attached")}if(!dom.box.parentNode){var foreground=this.parent.dom.foreground;if(!foreground){throw new Error("Cannot redraw item: parent has no foreground container element")}foreground.appendChild(dom.box)}this.displayed=true;if(this.dirty){this._updateContents(this.dom.content);this._updateTitle(this.dom.box);this._updateDataAttributes(this.dom.box);this._updateStyle(this.dom.box);var className=(this.data.className?" "+this.data.className:"")+(this.selected?" selected":"");dom.box.className=this.baseClassName+className;this.overflow=window.getComputedStyle(dom.content).overflow!=="hidden";this.dom.content.style.maxWidth="none";this.props.content.width=this.dom.content.offsetWidth;this.height=this.dom.box.offsetHeight;this.dom.content.style.maxWidth="";this.dirty=false}this._repaintDeleteButton(dom.box);this._repaintDragLeft();this._repaintDragRight()};RangeItem.prototype.show=function(){if(!this.displayed){this.redraw()}};RangeItem.prototype.hide=function(){if(this.displayed){var box=this.dom.box;if(box.parentNode){box.parentNode.removeChild(box)}this.displayed=false}};RangeItem.prototype.repositionX=function(limitSize){var parentWidth=this.parent.width;var start=this.conversion.toScreen(this.data.start);var end=this.conversion.toScreen(this.data.end);var contentLeft;var contentWidth;if(limitSize===undefined||limitSize===true){if(start<-parentWidth){start=-parentWidth}if(end>2*parentWidth){end=2*parentWidth}}var boxWidth=Math.max(end-start,1);if(this.overflow){this.left=start;this.width=boxWidth+this.props.content.width;contentWidth=this.props.content.width}else{this.left=start;this.width=boxWidth;contentWidth=Math.min(end-start-2*this.options.padding,this.props.content.width)}this.dom.box.style.left=this.left+"px";this.dom.box.style.width=boxWidth+"px";switch(this.options.align){case"left":this.dom.content.style.left="0";break;case"right":this.dom.content.style.left=Math.max(boxWidth-contentWidth-2*this.options.padding,0)+"px";break;case"center":this.dom.content.style.left=Math.max((boxWidth-contentWidth-2*this.options.padding)/2,0)+"px";break;default:if(this.overflow){if(end>0){contentLeft=Math.max(-start,0)}else{contentLeft=-contentWidth}}else{if(start<0){contentLeft=Math.min(-start,end-start-contentWidth-2*this.options.padding)}else{contentLeft=0}}this.dom.content.style.left=contentLeft+"px"}};RangeItem.prototype.repositionY=function(){var orientation=this.options.orientation,box=this.dom.box;if(orientation=="top"){box.style.top=this.top+"px"}else{box.style.top=this.parent.height-this.top-this.height+"px"}};RangeItem.prototype._repaintDragLeft=function(){if(this.selected&&this.options.editable.updateTime&&!this.dom.dragLeft){var dragLeft=document.createElement("div");dragLeft.className="drag-left";dragLeft.dragLeftItem=this;Hammer(dragLeft,{preventDefault:true}).on("drag",function(){});this.dom.box.appendChild(dragLeft);this.dom.dragLeft=dragLeft}else if(!this.selected&&this.dom.dragLeft){if(this.dom.dragLeft.parentNode){this.dom.dragLeft.parentNode.removeChild(this.dom.dragLeft)}this.dom.dragLeft=null}};RangeItem.prototype._repaintDragRight=function(){if(this.selected&&this.options.editable.updateTime&&!this.dom.dragRight){var dragRight=document.createElement("div");dragRight.className="drag-right";dragRight.dragRightItem=this;Hammer(dragRight,{preventDefault:true}).on("drag",function(){});this.dom.box.appendChild(dragRight);this.dom.dragRight=dragRight}else if(!this.selected&&this.dom.dragRight){if(this.dom.dragRight.parentNode){this.dom.dragRight.parentNode.removeChild(this.dom.dragRight)}this.dom.dragRight=null}};module.exports=RangeItem},{"../../../module/hammer":6,"./Item":24}],27:[function(require,module,exports){exports["en"]={current:"current",time:"time"};exports["en_EN"]=exports["en"];exports["en_US"]=exports["en"];exports["nl"]={current:"aangepaste",time:"tijd"};exports["nl_NL"]=exports["nl"];exports["nl_BE"]=exports["nl"]},{}],28:[function(require,module,exports){var moment=require("./module/moment");exports.isNumber=function(object){return object instanceof Number||typeof object=="number"};exports.giveRange=function(min,max,total,value){if(max==min){return.5}else{var scale=1/(max-min);return Math.max(0,(value-min)*scale)}};exports.isString=function(object){return object instanceof String||typeof object=="string"};exports.isDate=function(object){if(object instanceof Date){return true}else if(exports.isString(object)){var match=ASPDateRegex.exec(object);if(match){return true}else if(!isNaN(Date.parse(object))){return true}}return false};exports.isDataTable=function(object){return typeof google!=="undefined"&&google.visualization&&google.visualization.DataTable&&object instanceof google.visualization.DataTable};exports.randomUUID=function(){var S4=function(){return Math.floor(Math.random()*65536).toString(16)};return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()};exports.extend=function(a,b){for(var i=1,len=arguments.length;i<len;i++){var other=arguments[i];for(var prop in other){if(other.hasOwnProperty(prop)){a[prop]=other[prop]}}}return a};exports.selectiveExtend=function(props,a,b){if(!Array.isArray(props)){throw new Error("Array with property names expected as first argument")}for(var i=2;i<arguments.length;i++){var other=arguments[i];for(var p=0;p<props.length;p++){var prop=props[p];if(other.hasOwnProperty(prop)){a[prop]=other[prop]}}}return a};exports.selectiveDeepExtend=function(props,a,b){if(Array.isArray(b)){throw new TypeError("Arrays are not supported by deepExtend")}for(var i=2;i<arguments.length;i++){var other=arguments[i];for(var p=0;p<props.length;p++){var prop=props[p];if(other.hasOwnProperty(prop)){if(b[prop]&&b[prop].constructor===Object){if(a[prop]===undefined){a[prop]={}}if(a[prop].constructor===Object){exports.deepExtend(a[prop],b[prop])}else{a[prop]=b[prop]}}else if(Array.isArray(b[prop])){throw new TypeError("Arrays are not supported by deepExtend")}else{a[prop]=b[prop]}}}}return a};exports.selectiveNotDeepExtend=function(props,a,b){if(Array.isArray(b)){throw new TypeError("Arrays are not supported by deepExtend")}for(var prop in b){if(b.hasOwnProperty(prop)){if(props.indexOf(prop)==-1){if(b[prop]&&b[prop].constructor===Object){if(a[prop]===undefined){a[prop]={}}if(a[prop].constructor===Object){exports.deepExtend(a[prop],b[prop])}else{a[prop]=b[prop]}}else if(Array.isArray(b[prop])){throw new TypeError("Arrays are not supported by deepExtend")}else{a[prop]=b[prop]}}}}return a};exports.deepExtend=function(a,b){if(Array.isArray(b)){throw new TypeError("Arrays are not supported by deepExtend")}for(var prop in b){if(b.hasOwnProperty(prop)){if(b[prop]&&b[prop].constructor===Object){if(a[prop]===undefined){a[prop]={}}if(a[prop].constructor===Object){exports.deepExtend(a[prop],b[prop])}else{a[prop]=b[prop]}}else if(Array.isArray(b[prop])){throw new TypeError("Arrays are not supported by deepExtend")}else{a[prop]=b[prop]}}}return a};exports.equalArray=function(a,b){if(a.length!=b.length)return false;for(var i=0,len=a.length;i<len;i++){if(a[i]!=b[i])return false}return true};exports.convert=function(object,type){var match;if(object===undefined){return undefined}if(object===null){return null}if(!type){return object}if(!(typeof type==="string")&&!(type instanceof String)){throw new Error("Type must be a string")}switch(type){case"boolean":case"Boolean":return Boolean(object);case"number":case"Number":return Number(object.valueOf());case"string":case"String":return String(object);case"Date":if(exports.isNumber(object)){return new Date(object)}if(object instanceof Date){return new Date(object.valueOf())}else if(moment.isMoment(object)){return new Date(object.valueOf())}if(exports.isString(object)){match=ASPDateRegex.exec(object);if(match){return new Date(Number(match[1]))}else{return moment(object).toDate()}}else{throw new Error("Cannot convert object of type "+exports.getType(object)+" to type Date")}case"Moment":if(exports.isNumber(object)){return moment(object)}if(object instanceof Date){return moment(object.valueOf())}else if(moment.isMoment(object)){return moment(object)}if(exports.isString(object)){match=ASPDateRegex.exec(object);if(match){return moment(Number(match[1]))}else{return moment(object)}}else{throw new Error("Cannot convert object of type "+exports.getType(object)+" to type Date")}case"ISODate":if(exports.isNumber(object)){return new Date(object)}else if(object instanceof Date){return object.toISOString()}else if(moment.isMoment(object)){return object.toDate().toISOString()}else if(exports.isString(object)){match=ASPDateRegex.exec(object);if(match){return new Date(Number(match[1])).toISOString()}else{return new Date(object).toISOString()}}else{throw new Error("Cannot convert object of type "+exports.getType(object)+" to type ISODate")}case"ASPDate":if(exports.isNumber(object)){return"/Date("+object+")/"}else if(object instanceof Date){return"/Date("+object.valueOf()+")/"}else if(exports.isString(object)){match=ASPDateRegex.exec(object);var value;if(match){value=new Date(Number(match[1])).valueOf()}else{value=new Date(object).valueOf()}return"/Date("+value+")/"}else{throw new Error("Cannot convert object of type "+exports.getType(object)+" to type ASPDate")}default:throw new Error('Unknown type "'+type+'"')}};var ASPDateRegex=/^\/?Date\((\-?\d+)/i;exports.getType=function(object){var type=typeof object;if(type=="object"){if(object==null){return"null"}if(object instanceof Boolean){return"Boolean"}if(object instanceof Number){return"Number"}if(object instanceof String){return"String"}if(Array.isArray(object)){return"Array"}if(object instanceof Date){return"Date"}return"Object"}else if(type=="number"){return"Number"}else if(type=="boolean"){return"Boolean"}else if(type=="string"){return"String"}return type};exports.getAbsoluteLeft=function(elem){return elem.getBoundingClientRect().left+window.pageXOffset};exports.getAbsoluteTop=function(elem){return elem.getBoundingClientRect().top+window.pageYOffset};exports.addClassName=function(elem,className){var classes=elem.className.split(" ");if(classes.indexOf(className)==-1){classes.push(className);elem.className=classes.join(" ")}};exports.removeClassName=function(elem,className){var classes=elem.className.split(" ");var index=classes.indexOf(className);if(index!=-1){classes.splice(index,1);elem.className=classes.join(" ")}};exports.forEach=function(object,callback){var i,len;if(Array.isArray(object)){for(i=0,len=object.length;i<len;i++){callback(object[i],i,object)}}else{for(i in object){if(object.hasOwnProperty(i)){callback(object[i],i,object)}}}};exports.toArray=function(object){var array=[];for(var prop in object){if(object.hasOwnProperty(prop))array.push(object[prop])}return array};exports.updateProperty=function(object,key,value){if(object[key]!==value){object[key]=value;return true}else{return false}};exports.addEventListener=function(element,action,listener,useCapture){if(element.addEventListener){if(useCapture===undefined)useCapture=false;if(action==="mousewheel"&&navigator.userAgent.indexOf("Firefox")>=0){action="DOMMouseScroll"}element.addEventListener(action,listener,useCapture)}else{element.attachEvent("on"+action,listener)}};exports.removeEventListener=function(element,action,listener,useCapture){if(element.removeEventListener){if(useCapture===undefined)useCapture=false;if(action==="mousewheel"&&navigator.userAgent.indexOf("Firefox")>=0){action="DOMMouseScroll"}element.removeEventListener(action,listener,useCapture)}else{element.detachEvent("on"+action,listener)}};exports.preventDefault=function(event){if(!event)event=window.event;if(event.preventDefault){event.preventDefault()}else{event.returnValue=false}};exports.getTarget=function(event){if(!event){event=window.event}var target;if(event.target){target=event.target}else if(event.srcElement){target=event.srcElement}if(target.nodeType!=undefined&&target.nodeType==3){target=target.parentNode}return target};exports.hasParent=function(element,parent){var e=element;while(e){if(e===parent){return true}e=e.parentNode}return false};exports.option={};exports.option.asBoolean=function(value,defaultValue){if(typeof value=="function"){value=value()}if(value!=null){return value!=false}return defaultValue||null};exports.option.asNumber=function(value,defaultValue){if(typeof value=="function"){value=value()}if(value!=null){return Number(value)||defaultValue||null}return defaultValue||null};exports.option.asString=function(value,defaultValue){if(typeof value=="function"){value=value()}if(value!=null){return String(value)}return defaultValue||null};exports.option.asSize=function(value,defaultValue){if(typeof value=="function"){value=value()}if(exports.isString(value)){return value}else if(exports.isNumber(value)){return value+"px"}else{return defaultValue||null}};exports.option.asElement=function(value,defaultValue){if(typeof value=="function"){value=value()}return value||defaultValue||null};exports.hexToRGB=function(hex){var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null};exports.overrideOpacity=function(color,opacity){if(color.indexOf("rgb")!=-1){var rgb=color.substr(color.indexOf("(")+1).replace(")","").split(",");return"rgba("+rgb[0]+","+rgb[1]+","+rgb[2]+","+opacity+")"}else{var rgb=exports.hexToRGB(color);if(rgb==null){return color}else{return"rgba("+rgb.r+","+rgb.g+","+rgb.b+","+opacity+")"}}};exports.RGBToHex=function(red,green,blue){return"#"+((1<<24)+(red<<16)+(green<<8)+blue).toString(16).slice(1)};exports.parseColor=function(color){var c;if(exports.isString(color)){if(exports.isValidRGB(color)){var rgb=color.substr(4).substr(0,color.length-5).split(",");color=exports.RGBToHex(rgb[0],rgb[1],rgb[2])}if(exports.isValidHex(color)){var hsv=exports.hexToHSV(color);var lighterColorHSV={h:hsv.h,s:hsv.s*.45,v:Math.min(1,hsv.v*1.05)};var darkerColorHSV={h:hsv.h,s:Math.min(1,hsv.v*1.25),v:hsv.v*.6};var darkerColorHex=exports.HSVToHex(darkerColorHSV.h,darkerColorHSV.h,darkerColorHSV.v);var lighterColorHex=exports.HSVToHex(lighterColorHSV.h,lighterColorHSV.s,lighterColorHSV.v);c={background:color,border:darkerColorHex,highlight:{background:lighterColorHex,border:darkerColorHex},hover:{background:lighterColorHex,border:darkerColorHex}}}else{c={background:color,border:color,highlight:{background:color,border:color},hover:{background:color,border:color}}}}else{c={};c.background=color.background||"white";c.border=color.border||c.background;if(exports.isString(color.highlight)){c.highlight={border:color.highlight,background:color.highlight}}else{c.highlight={};c.highlight.background=color.highlight&&color.highlight.background||c.background;c.highlight.border=color.highlight&&color.highlight.border||c.border}if(exports.isString(color.hover)){c.hover={border:color.hover,background:color.hover}}else{c.hover={};c.hover.background=color.hover&&color.hover.background||c.background;c.hover.border=color.hover&&color.hover.border||c.border}}return c};exports.RGBToHSV=function(red,green,blue){red=red/255;green=green/255;blue=blue/255;var minRGB=Math.min(red,Math.min(green,blue));var maxRGB=Math.max(red,Math.max(green,blue));if(minRGB==maxRGB){return{h:0,s:0,v:minRGB}}var d=red==minRGB?green-blue:blue==minRGB?red-green:blue-red;var h=red==minRGB?3:blue==minRGB?1:5;var hue=60*(h-d/(maxRGB-minRGB))/360;var saturation=(maxRGB-minRGB)/maxRGB;var value=maxRGB;return{h:hue,s:saturation,v:value}};var cssUtil={split:function(cssText){var styles={};cssText.split(";").forEach(function(style){if(style.trim()!=""){var parts=style.split(":");var key=parts[0].trim();var value=parts[1].trim();styles[key]=value}});return styles},join:function(styles){return Object.keys(styles).map(function(key){return key+": "+styles[key]}).join("; ")}};exports.addCssText=function(element,cssText){var currentStyles=cssUtil.split(element.style.cssText);var newStyles=cssUtil.split(cssText);var styles=exports.extend(currentStyles,newStyles);element.style.cssText=cssUtil.join(styles)};exports.removeCssText=function(element,cssText){var styles=cssUtil.split(element.style.cssText);var removeStyles=cssUtil.split(cssText);for(var key in removeStyles){if(removeStyles.hasOwnProperty(key)){delete styles[key]}}element.style.cssText=cssUtil.join(styles)};exports.HSVToRGB=function(h,s,v){var r,g,b;var i=Math.floor(h*6);var f=h*6-i;var p=v*(1-s);var q=v*(1-f*s);var t=v*(1-(1-f)*s);switch(i%6){case 0:r=v,g=t,b=p;break;case 1:r=q,g=v,b=p;break;case 2:r=p,g=v,b=t;break;case 3:r=p,g=q,b=v;break;case 4:r=t,g=p,b=v;break;case 5:r=v,g=p,b=q;break}return{r:Math.floor(r*255),g:Math.floor(g*255),b:Math.floor(b*255)}};exports.HSVToHex=function(h,s,v){var rgb=exports.HSVToRGB(h,s,v);return exports.RGBToHex(rgb.r,rgb.g,rgb.b)};exports.hexToHSV=function(hex){var rgb=exports.hexToRGB(hex);return exports.RGBToHSV(rgb.r,rgb.g,rgb.b)};exports.isValidHex=function(hex){var isOk=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(hex);return isOk};exports.isValidRGB=function(rgb){
rgb=rgb.replace(" ","");var isOk=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/i.test(rgb);return isOk};exports.selectiveBridgeObject=function(fields,referenceObject){if(typeof referenceObject=="object"){var objectTo=Object.create(referenceObject);for(var i=0;i<fields.length;i++){if(referenceObject.hasOwnProperty(fields[i])){if(typeof referenceObject[fields[i]]=="object"){objectTo[fields[i]]=exports.bridgeObject(referenceObject[fields[i]])}}}return objectTo}else{return null}};exports.bridgeObject=function(referenceObject){if(typeof referenceObject=="object"){var objectTo=Object.create(referenceObject);for(var i in referenceObject){if(referenceObject.hasOwnProperty(i)){if(typeof referenceObject[i]=="object"){objectTo[i]=exports.bridgeObject(referenceObject[i])}}}return objectTo}else{return null}};exports.mergeOptions=function(mergeTarget,options,option){if(options[option]!==undefined){if(typeof options[option]=="boolean"){mergeTarget[option].enabled=options[option]}else{mergeTarget[option].enabled=true;for(var prop in options[option]){if(options[option].hasOwnProperty(prop)){mergeTarget[option][prop]=options[option][prop]}}}}};exports.binarySearchCustom=function(orderedItems,searchFunction,field,field2){var maxIterations=1e4;var iteration=0;var low=0;var high=orderedItems.length-1;while(low<=high&&iteration<maxIterations){var middle=Math.floor((low+high)/2);var item=orderedItems[middle];var value=field2===undefined?item[field]:item[field][field2];var searchResult=searchFunction(value);if(searchResult==0){return middle}else if(searchResult==-1){low=middle+1}else{high=middle-1}iteration++}return-1};exports.binarySearchValue=function(orderedItems,target,field,sidePreference){var maxIterations=1e4;var iteration=0;var low=0;var high=orderedItems.length-1;var prevValue,value,nextValue,middle;while(low<=high&&iteration<maxIterations){middle=Math.floor(.5*(high+low));prevValue=orderedItems[Math.max(0,middle-1)][field];value=orderedItems[middle][field];nextValue=orderedItems[Math.min(orderedItems.length-1,middle+1)][field];if(value==target){return middle}else if(prevValue<target&&value>target){return sidePreference=="before"?Math.max(0,middle-1):middle}else if(value<target&&nextValue>target){return sidePreference=="before"?middle:Math.min(orderedItems.length-1,middle+1)}else{if(value<target){low=middle+1}else{high=middle-1}}iteration++}return-1};exports.easeInOutQuad=function(t,start,end,duration){var change=end-start;t/=duration/2;if(t<1)return change/2*t*t+start;t--;return-change/2*(t*(t-2)-1)+start};exports.easingFunctions={linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return t<.5?2*t*t:-1+(4-2*t)*t},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return 1- --t*t*t*t},easeInOutQuart:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return 1+--t*t*t*t*t},easeInOutQuint:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t}}},{"./module/moment":7}],29:[function(require,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],30:[function(require,module,exports){"use strict";(function(root,factory){if(typeof define==="function"&&define.amd){define([],factory)}else if(typeof exports==="object"){module.exports=factory()}else{root.keycharm=factory()}})(this,function(){function keycharm(options){var preventDefault=options&&options.preventDefault||false;var container=options&&options.container||window;var _exportFunctions={};var _bound={keydown:{},keyup:{}};var _keys={};var i;for(i=97;i<=122;i++){_keys[String.fromCharCode(i)]={code:65+(i-97),shift:false}}for(i=65;i<=90;i++){_keys[String.fromCharCode(i)]={code:i,shift:true}}for(i=0;i<=9;i++){_keys[""+i]={code:48+i,shift:false}}for(i=1;i<=12;i++){_keys["F"+i]={code:111+i,shift:false}}for(i=0;i<=9;i++){_keys["num"+i]={code:96+i,shift:false}}_keys["num*"]={code:106,shift:false};_keys["num+"]={code:107,shift:false};_keys["num-"]={code:109,shift:false};_keys["num/"]={code:111,shift:false};_keys["num."]={code:110,shift:false};_keys["left"]={code:37,shift:false};_keys["up"]={code:38,shift:false};_keys["right"]={code:39,shift:false};_keys["down"]={code:40,shift:false};_keys["space"]={code:32,shift:false};_keys["enter"]={code:13,shift:false};_keys["shift"]={code:16,shift:undefined};_keys["esc"]={code:27,shift:false};_keys["backspace"]={code:8,shift:false};_keys["tab"]={code:9,shift:false};_keys["ctrl"]={code:17,shift:false};_keys["alt"]={code:18,shift:false};_keys["delete"]={code:46,shift:false};_keys["pageup"]={code:33,shift:false};_keys["pagedown"]={code:34,shift:false};_keys["="]={code:187,shift:false};_keys["-"]={code:189,shift:false};_keys["]"]={code:221,shift:false};_keys["["]={code:219,shift:false};var down=function(event){handleEvent(event,"keydown")};var up=function(event){handleEvent(event,"keyup")};var handleEvent=function(event,type){if(_bound[type][event.keyCode]!==undefined){var bound=_bound[type][event.keyCode];for(var i=0;i<bound.length;i++){if(bound[i].shift===undefined){bound[i].fn(event)}else if(bound[i].shift==true&&event.shiftKey==true){bound[i].fn(event)}else if(bound[i].shift==false&&event.shiftKey==false){bound[i].fn(event)}}if(preventDefault==true){event.preventDefault()}}};_exportFunctions.bind=function(key,callback,type){if(type===undefined){type="keydown"}if(_keys[key]===undefined){throw new Error("unsupported key: "+key)}if(_bound[type][_keys[key].code]===undefined){_bound[type][_keys[key].code]=[]}_bound[type][_keys[key].code].push({fn:callback,shift:_keys[key].shift})};_exportFunctions.bindAll=function(callback,type){if(type===undefined){type="keydown"}for(var key in _keys){if(_keys.hasOwnProperty(key)){_exportFunctions.bind(key,callback,type)}}};_exportFunctions.getKey=function(event){for(var key in _keys){if(_keys.hasOwnProperty(key)){if(event.shiftKey==true&&_keys[key].shift==true&&event.keyCode==_keys[key].code){return key}else if(event.shiftKey==false&&_keys[key].shift==false&&event.keyCode==_keys[key].code){return key}else if(event.keyCode==_keys[key].code&&key=="shift"){return key}}}return"unknown key, currently not supported"};_exportFunctions.unbind=function(key,callback,type){if(type===undefined){type="keydown"}if(_keys[key]===undefined){throw new Error("unsupported key: "+key)}if(callback!==undefined){var newBindings=[];var bound=_bound[type][_keys[key].code];if(bound!==undefined){for(var i=0;i<bound.length;i++){if(!(bound[i].fn==callback&&bound[i].shift==_keys[key].shift)){newBindings.push(_bound[type][_keys[key].code][i])}}}_bound[type][_keys[key].code]=newBindings}else{_bound[type][_keys[key].code]=[]}};_exportFunctions.reset=function(){_bound={keydown:{},keyup:{}}};_exportFunctions.destroy=function(){_bound={keydown:{},keyup:{}};container.removeEventListener("keydown",down,true);container.removeEventListener("keyup",up,true)};container.addEventListener("keydown",down,true);container.addEventListener("keyup",up,true);return _exportFunctions}return keycharm})},{}]},{},[1])(1)});